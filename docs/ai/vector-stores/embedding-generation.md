---
title: Generating embeddings for Vector Store connectors
description: Describes how you can generate embeddings to use with Vector Store connectors.
ms.topic: concept-article
ms.date: 09/23/2024
---

# Generating embeddings for Vector Store connectors

Vector Store connectors support multiple ways of generating embeddings.
Embeddings can be generated by the developer and passed as part of a record when using a <xref:Microsoft.Extensions.VectorData.VectorStoreCollection%602> or can be generated internally to the <xref:Microsoft.Extensions.VectorData.VectorStoreCollection%602>.

## Let the Vector Store generate embeddings

You can configure an embedding generator on your vector store, allowing embeddings to be automatically generated during both upsert and search operations, eliminating the need for manual preprocessing.

To enable generating vectors automatically on upsert, the vector property on your data model is defined as the source type, for example, string but still decorated with a <xref:Microsoft.Extensions.VectorData.VectorStoreVectorAttribute>.

:::code language="csharp" source="./snippets/embedding-generation.cs" id="LetTheVectorStoreGenerateEmbeddings":::

Before upsert, the `Embedding` property should contain the string from which a vector should be generated. The type of the vector stored in the database (for example, float32, float16, etc.) will be derived from the configured embedding generator.

> [!IMPORTANT]
> These vector properties do not support retrieving either the generated vector or the original text that the vector was generated from. They also do not store the original text.
> If the original text needs to be stored, a separate Data property should be added to store it.

Embedding generators implementing the `Microsoft.Extensions.AI` abstractions are supported and can be configured at various levels:

1. **On the Vector Store**:

   You can set a default embedding generator for the entire vector store. This generator will be used for all collections and properties unless overridden.

   :::code language="csharp" source="./snippets/embedding-generation.cs" id="OnTheVectorStore":::

2. **On a Collection**:

   You can configure an embedding generator for a specific collection, overriding the store-level generator.

   :::code language="csharp" source="./snippets/embedding-generation.cs" id="OnACollection":::

3. **On a Record Definition**:
    When defining properties programmatically using <xref:Microsoft.Extensions.VectorData.VectorStoreCollectionDefinition>, you can specify an embedding generator for all properties.

    :::code language="csharp" source="./snippets/embedding-generation.cs" id="OnARecordDefinition":::

4. **On a Vector Property Definition**:
    When defining properties programmatically, you can set an embedding generator directly on the property.

    :::code language="csharp" source="./snippets/embedding-generation.cs" id="OnAVectorPropertyDefinition":::

### Example usage

The following example demonstrates how to use the embedding generator to automatically generate vectors during both upsert and search operations. This approach simplifies workflows by eliminating the need to precompute embeddings manually.

:::code language="csharp" source="./snippets/embedding-generation.cs" id="ExampleUsage":::

## Generate embeddings yourself

### Construct an embedding generator

For information on how to construct `Microsoft.Extensions.AI` embedding generators, see [Microsoft.Extensions.AI.Abstractions](https://www.nuget.org/packages/Microsoft.Extensions.AI.Abstractions).

### Generate embeddings on upsert with `IEmbeddingGenerator`

:::code language="csharp" source="./snippets/embedding-generation.cs" id="GenerateEmbeddingsOnUpsertWithIEmbedding":::

### Generate embeddings on search with `IEmbeddingGenerator`

:::code language="csharp" source="./snippets/embedding-generation.cs" id="GenerateEmbeddingsOnSearchWithIEmbedding":::

## Embedding dimensions

Vector databases typically require you to specify the number of dimensions that each vector has when creating the collection.
Different embedding models typically support generating vectors with various dimension sizes. For example, OpenAI `text-embedding-ada-002`
generates vectors with 1536 dimensions. Some models also allow a developer to choose the number of dimensions they want in the
output vector. For example, Google `text-embedding-004` produces vectors with 768 dimensions by default, but allows a developer to
choose any number of dimensions between 1 and 768.

It's important to ensure that the vectors generated by the embedding model have the same number of dimensions as the
matching vector in the database.

If creating a collection using the Vector Store abstractions, you need to specify the number of dimensions
required for each vector property either via annotations or via the record definition. Here are examples of both setting
the number of dimensions to 1536.

:::code language="csharp" source="./snippets/embedding-generation.cs" id="EmbeddingDimensions1":::

:::code language="csharp" source="./snippets/embedding-generation.cs" id="EmbeddingDimensions2":::

## See also

- [Defining your data model](./defining-your-data-model.md)
- [Defining your schema with a record definition](./schema-with-record-definition.md)