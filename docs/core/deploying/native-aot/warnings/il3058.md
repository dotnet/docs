---
title: "IL3058: Referenced assembly is not marked as AOT-compatible"
description: "Learn about warning IL3058: Referenced assembly is not marked as AOT-compatible"
ms.date: 12/02/2024
f1_keywords:
  - "IL3058"
---
# IL3058: Referenced assembly is not marked as AOT-compatible

## Cause

A project has `<VerifyReferenceAotCompatibility>true</VerifyReferenceAotCompatibility>` set, and one or more referenced assemblies don't have the `IsAotCompatible` assembly metadata attribute set to `true`.

## Rule description

When you enable AOT analysis with `<EnableAotAnalyzer>true</EnableAotAnalyzer>` or mark your project as AOT-compatible with `<IsAotCompatible>true</IsAotCompatible>`, you can optionally enable verification that all referenced assemblies are also marked as AOT-compatible. This helps ensure that all dependencies in your project are compatible with Native AOT compilation.

To enable this verification, set the `VerifyReferenceAotCompatibility` property to `true` in your project file:

```xml
<PropertyGroup>
  <EnableAotAnalyzer>true</EnableAotAnalyzer>
  <VerifyReferenceAotCompatibility>true</VerifyReferenceAotCompatibility>
</PropertyGroup>
```

When this property is enabled, the analyzer checks that all referenced assemblies have been built with `<IsAotCompatible>true</IsAotCompatible>`, which adds the assembly-level attribute `[assembly: AssemblyMetadata("IsAotCompatible", "True")]` to the assembly.

## Example

```csharp
// Assembly reference: MyLibrary.dll (built without <IsAotCompatible>true</IsAotCompatible>)

public class Program
{
    public static void Main()
    {
        // IL3058: Referenced assembly 'MyLibrary' is not built with `<IsAotCompatible>true</IsAotCompatible>`
        // and may not be compatible with AOT.
        var obj = new MyLibrary.SomeClass();
    }
}
```

## How to fix violations

You have several options to fix this warning:

1. **Update the referenced library** to be built with `<IsAotCompatible>true</IsAotCompatible>`. This is the preferred approach if you control the library source code. The `IsAotCompatible` property marks the assembly as compatible with Native AOT and enables AOT-specific analysis.

2. **Disable the verification** by setting `<VerifyReferenceAotCompatibility>false</VerifyReferenceAotCompatibility>` in your project file if you're confident that the library works correctly with Native AOT even without the attribute.

3. **Suppress the warning** for specific assemblies using `#pragma warning disable IL3058` or the `UnconditionalSuppressMessageAttribute` if you've verified that the specific library is safe to use with Native AOT.

## When to suppress warnings

It's safe to suppress this warning if:

- You've tested the referenced library with Native AOT and verified it works correctly.
- The referenced library doesn't use reflection, dynamic code generation, or other features that are incompatible with Native AOT.
- You're using a legacy library that works with Native AOT but wasn't built with the `IsAotCompatible` property.

However, be aware that suppressing this warning means the library hasn't been explicitly marked as AOT-compatible by its author, so there's a risk of runtime failures if the library uses features that require runtime code generation or other capabilities not available in Native AOT.

## See also

- [Native AOT deployment](../index.md)
- [Introduction to AOT warnings](../fixing-warnings.md)
- [Prepare .NET libraries for trimming](../../trimming/prepare-libraries-for-trimming.md)
