---
title: "Application Compatibility in the .NET Framework 4.5 | Microsoft Docs"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "application compatibility, .NET Framework"
  - "breaking changes [.NET Framework]"
ms.assetid: 5c50747c-806c-44a9-ac58-5bbe12a284fa
caps.latest.revision: 76
author: "rpetrusha"
ms.author: "ronpet"
manager: "wpickett"
---
# Application Compatibility in the .NET Framework 4.5
This topic describes application compatibility issues between the .NET Framework 4 and 4.5, including fixes and changes based on customer feedback. Most of these changes do not require any programming modifications in your applications. For those that may involve modifications, see the Impact column of the tables.  
  
> [!IMPORTANT]
>  Note that the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)] is not supported on [!INCLUDE[winxp](../../../includes/winxp-md.md)].  
  
 For compatibility issues between the .NET Framework 4.5 and 4.5.1, see [Application Compatibility in 4.5.1](../../../docs/framework/migration-guide/application-compatibility-in-the-net-framework-4-5-1.md).  
  
 This topic describes notable changes in the following areas:  
  
-   [Core](#core)  
  
-   [Data](#sql)  
  
-   [Networking](#network)  
  
-   [Serialization](#serialize)  
  
-   [Printing](#Printing)  
  
-   [Tools and Resources](#tools)  
  
-   [ASP.NET](#asp)  
  
-   [ClickOnce](#ClickOnce)  
  
-   [Managed Extensibility Framework (MEF)](#mef)  
  
-   [Web Applications](#web)  
  
-   [Windows Communication Foundation (WCF)](#wcf)  
  
-   [Windows Forms](#winForms)  
  
-   [Windows Presentation Foundation (WPF)](#wpf)  
  
-   [Windows Workflow Foundation (WF)](../../../docs/framework/migration-guide/application-compatibility-in-the-net-framework-4-5.md#wwf)  
  
-   [XML, XSLT](#xml)  
  
 This topic does not discuss types and members that have been declared obsolete in the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]. For a list of these, see [What's Obsolete in the Class Library](../../../docs/framework/whats-new/whats-obsolete.md). For information about new features, see [What's New](../../../docs/framework/whats-new/index.md).  
  
<a name="core"></a>   
## Core  
 In addition to the following application compatibility issues, see the [Serialization](#serialize) section for serialization-related issues.  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|<xref:System.Collections.Concurrent.BlockingCollection%601.TryTakeFromAny%28System.Collections.Concurrent.BlockingCollection%7B%600%7D%5B%5D%2C%600%40%29?displayProperty=fullName> and <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A?displayProperty=fullName> methods|The <xref:System.Collections.Concurrent.BlockingCollection%601.TryTakeFromAny%28System.Collections.Concurrent.BlockingCollection%7B%600%7D%5B%5D%2C%600%40%29?displayProperty=fullName> method no longer returns -1 or throws an exception. The <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A?displayProperty=fullName> method no longer throws an exception if one of the collections is marked completed.|This change makes it possible to work with collections when one of the collections is either empty or completed, but the other collection still has items that can be retrieved.|  
|<xref:System.Text.RegularExpressions.Regex.CompileToAssembly%2A?displayProperty=fullName>|If an assembly of compiled regular expressions is built with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)] but targets the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], attempting to use one of the regular expressions in that assembly on a system with [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] installed throws an exception.|To work around this problem, you can do either of the following:<br /><br /> Build the assembly that contains the regular expressions with the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)].<br /><br /> Use an interpreted regular expression.|  
|<xref:System.Threading.Tasks.Task?displayProperty=fullName> disposal|Except for `Task.IAsyncResult.AsyncWaitHandle`, <xref:System.Threading.Tasks.Task?displayProperty=fullName> methods no longer throw an <xref:System.ObjectDisposedException> exception after the object is disposed.|This change supports the use of cached tasks. For example, a method can return a cached task to represent an already completed operation instead of allocating a new task. This was impossible in previous .NET Framework versions, because any consumer of the task could dispose of it, which rendered it unusable.|  
|Unobserved exceptions in <xref:System.Threading.Tasks.Task?displayProperty=fullName> operations|Because the <xref:System.Threading.Tasks.Task?displayProperty=fullName> class represents an asynchronous operation, it catches all non-severe exceptions that occur during asynchronous processing. In the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], if an exception is not observed and your code never waits on the task, the exception will no longer propagate on the finalizer thread and crash the process during garbage collection.|This change enhances the reliability of applications that use the <xref:System.Threading.Tasks.Task> class to perform unobserved asynchronous processing. The previous behavior can be restored by providing an appropriate handler for the <xref:System.Threading.Tasks.TaskScheduler.UnobservedTaskException?displayProperty=fullName> event.|  
|<xref:System.Threading.Tasks.Task.WaitAll%2A?displayProperty=fullName> methods with time-out arguments|In the [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)], these methods behaved inconsistently. When the time-out expired, if one or more tasks were completed or canceled before the method call, the method threw an <xref:System.AggregateException> exception. When the time-out expired, if no tasks were completed or canceled before the method call, but one or more tasks entered these states after the method call, the method returned `false`.<br /><br /> In the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], these method overloads now return `false` if any tasks are still running when the time-out interval expires, and they throw an <xref:System.AggregateException> exception only if an input task was cancelled (regardless of whether it was cancelled before or after the method call) and no other tasks are still running.|This change makes the method's behavior consistent. However, it is possible (but unlikely) for application code to depend on time-out enabled <xref:System.Threading.Tasks.Task.WaitAll%2A?displayProperty=fullName> overloads to throw an exception when at least one task has already faulted or has been canceled before the time-out has expired. In that case, the <xref:System.Threading.Tasks.Task.IsCanceled%2A?displayProperty=fullName> property can be used for the same purpose.|  
|Support for type forwarding when multi-targeting|A new CodeDOM feature allows a compiler to compile against the targeted version of mscorlib.dll instead of the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)] version of mscorlib.dll.|This change prevents compiler warnings (and compilation failure in cases where warnings are treated as errors) when CodeDOM finds two definitions for types that have been type-forwarded. This change may have unintended side effects only if different versions of reference assemblies are mixed in a single location.|  
|<xref:System.Collections.Generic.List%601.ForEach%2A?displayProperty=fullName>|The enumerator throws an <xref:System.InvalidOperationException> exception if an element in the collection is modified.|This change applies only to applications that target [!INCLUDE[net_v45](../../../includes/net-v45-md.md)] and should have no negative impact. It safeguards data integrity and makes it more likely that race conditions will be identified.|  
|<xref:System.Uri?displayProperty=fullName>|Two changes to International Resource Identifier (IRI) parsing affect URIs in applications that target the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]:<br /><br /> [\<iriParsing>](../../../docs/framework/configure-apps/file-schema/network/iriparsing-element-uri-settings.md) is enabled by default and cannot be turned off. Previously, it was disabled by default.<br /><br /> Unicode normalization form C (NFC) will no longer be performed on non-host portions of URIs. Previously, NFC was performed on the entire URI when `<iriParsing>` was enabled.|URIs that contain non-NFC (normalization form C) normalized file names will not be form-C normalized. Application failure may result if IRI parsing uses non-normalized strings to access files that have normalized file names. This only affects applications that target the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].|  
|<xref:System.Uri?displayProperty=fullName>|An invalid `mailto:` URL throws an exception in the <xref:System.Uri> class constructor.|This only affects applications that are recompiled and that target the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].|  
|<xref:System.Uri?displayProperty=fullName>|In applications that target the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], trailing dots at the end of a path segment in an original URI string (for example, `http://www.proseware.com/LLC./About.aspx`) are preserved. (Note that path segments that consist exactly of one or two dots, such as `http://www.proseware.com/..` or `http://www.proseware.com/./default.htm`, are removed, but path segments that have more than two consecutive dots (such as `http://localhost/dir1/.../dir2`) are preserved.|This change affects only applications that target the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]. Applications that rely on the trailing dots being removed may experience failure.|  
|<xref:System.Uri?displayProperty=fullName>|In applications that target the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], queries in a `file://` URI are allowed; the ? character is not escaped because it is interpreted as part of the path.|This change affects only applications that target the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]. Applications that rely on escaping the ? character may experience failure.|  
|<xref:System.Uri?displayProperty=fullName>|In applications that target the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], Unicode control characters from U+0080 through U+009F are incorrectly encoded.|Ordinarily, Unicode control characters are not used in URIs.|  
|<xref:System.Uri.EscapeDataString%2A?displayProperty=fullName>, <xref:System.Uri.EscapeUriString%2A?displayProperty=fullName>, and <xref:System.Uri.UnescapeDataString%2A?displayProperty=fullName>|The list of reserved and unreserved characters now supports [RFC 3986](http://tools.ietf.org/html/rfc3986).|Specific changes:<br /><br /> <xref:System.Uri.EscapeDataString%2A> escapes reserved characters based on RFC 3986.<br /><br /> <xref:System.Uri.EscapeUriString%2A> does not escape reserved characters.<br /><br /> <xref:System.Uri.UnescapeDataString%2A> does not throw an exception if it encounters an invalid escape sequence.<br /><br /> Unreserved escaped characters are un-escaped.|  
|<xref:System.Uri.IsWellFormedUriString%2A?displayProperty=fullName>|Beginning with the .NET Framework 4.5, strings are always considered well-formed in accordance with [RFC 3986](http://tools.ietf.org/html/rfc3986) and [RFC 3987](http://tools.ietf.org/html/rfc3987). In previous versions of the .NET Framework, a string is considered well-formed in accordance with RFC 3986 and RFC 3987 only if URI parsing and IDN parsing are enabled.|For apps that target the .NET Framework 4.5 or later versions, this method returns `false` for some URIs that are considered well-formed by apps that target earlier versions of the .NET Framework. For example, a relative URI that includes  a colon in its first segment (such as "2013.05.29_14:33:41") is no longer considered well-formed.<br /><br /> Note that this change only affects apps that target the .NET Framework 4.5 or later versions.|  
|<xref:System.Threading.Tasks.TaskFactory.FromAsync%2A?displayProperty=fullName>|The <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A?displayProperty=fullName> may now access the  <xref:System.IAsyncResult.CompletedSynchronously%2A?displayProperty=fullName> property. Incorrect implementations of  <xref:System.IAsyncResult.CompletedSynchronously%2A?displayProperty=fullName> may now result in undefined behavior in <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A?displayProperty=fullName> method calls.|The resulting task will not complete if the implementation if the <xref:System.IAsyncResult.CompletedSynchronously%2A?displayProperty=fullName> property incorrectly returns `true`.|  
  
<a name="sql"></a>   
## Data  
  
### SQLClient  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|Ability to connect to a SQL Server database from managed code that runs under the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].|The existing synchronous API code path was modified to add asynchronous support.|The presence of non-IFS Winsock Base Service Providers (BSPs) or Layered Service Providers (LSPs) may interfere with the ability to connect to SQL Server. For more information, see [SetFileCompletionNotificationModes API causes an IO completion port not work correctly with a non-IFS LSP installed](http://go.microsoft.com/fwlink/p/?LinkId=256032) on the Microsoft Support website.|  
|<xref:System.Data.SqlClient.SqlConnection?displayProperty=fullName> type|Connections to SQL Server 1997 databases are no longer supported.|Applications running under the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)] cannot connect to SQL Server 1997 databases.|  
|<xref:System.Data.SqlClient.SqlConnection?displayProperty=fullName> type|Connections to SQL Server databases using the Virtual Interface Adapter (VIA) protocol are no longer supported.|Applications running under the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)] cannot connect to SQL Server databases using VIA.|  
|<xref:System.Data.SqlClient.SqlBulkCopy?displayProperty=fullName> type|When inserting data into a column, <xref:System.Data.SqlClient.SqlBulkCopy> uses the encoding of the destination column rather than the default encoding for `VARCHAR` and `CHAR` types.|This change eliminates the possibility of data corruption caused by using the default encoding when the destination column does not use the default encoding. In rare cases, an existing application may throw a <xref:System.Data.SqlClient.SqlException> exception if the change in encoding produces data that is too big to fit into the destination column.|  
|<xref:System.Data.SqlClient?displayProperty=fullName> collation sequence|`sql_variant` data uses `sql_variant` collation rather than database collation.|This change addresses possible data corruption if the database collation differs from the `sql_variant` collation. Applications that rely on the corrupted data may experience failure.|  
  
### Entity Framework  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|Log files created by the <xref:System.Data.Objects.ObjectContext.CreateDatabase%2A?displayProperty=fullName> method|When the <xref:System.Data.Objects.ObjectContext.CreateDatabase%2A> method is called either directly or by using Code First with the SqlClient provider and an `AttachDBFilename` value in the connection string, it creates a log file named *filename*_log.ldf instead of *filename*.ldf (where *filename* is the name of the file specified by the `AttachDBFilename` value).|This change improves debugging by providing a log file named according to SQL Server specifications. It should have no unexpected side effects.|  
|Data Definition Language (DDL) APIs|The behavior of DDL APIs when `AttachDBFilename` is specified has changed as follows:<br /><br /> Connection strings need not specify an `Initial Catalog` value. Previously, both `AttatchDBFilename` and `Initial Catalog` were required.<br /><br /> If both `AttatchDBFilename` and `Initial Catalog` are specified and the given MDF file exists, the <xref:System.Data.Objects.ObjectContext.DatabaseExists%2A?displayProperty=fullName> method returns `true`. Previously, it returned `false`.<br /><br /> If both `AttatchDBFilename` and `Initial Catalog` are specified and the given MDF file exists, calling the <xref:System.Data.Objects.ObjectContext.DeleteDatabase%2A?displayProperty=fullName> method deletes the files.<br /><br /> If <xref:System.Data.Objects.ObjectContext.DeleteDatabase%2A?displayProperty=fullName> is called when the connection string specifies an `AttachDBFilename` value with an MDF that doesn't exist and an `Initial Catalog` that doesn't exist, the method throws an <xref:System.InvalidOperationException> exception. Previously, it threw a <xref:System.Data.SqlClient.SqlException> exception.|These changes make it easier to build tools and applications that use the DDL APIs. These changes can affect application compatibility in the following scenarios:<br /><br /> The user writes code that executes a `DROP DATABASE` command directly instead of calling <xref:System.Data.Objects.ObjectContext.DeleteDatabase%2A?displayProperty=fullName> if <xref:System.Data.Objects.ObjectContext.DatabaseExists%2A?displayProperty=fullName> returns `true`. This breaks existing code If the database is not attached but the MDF file exists.<br /><br /> The user writes code that expects the <xref:System.Data.Objects.ObjectContext.DeleteDatabase%2A?displayProperty=fullName> method to throw a <xref:System.Data.SqlClient.SqlException> exception rather than an <xref:System.InvalidOperationException> exception when the `Initial Catalog` and MDF file don't exist.|  
|<xref:System.Data.Objects.ObjectContext.CreateDatabase%2A?displayProperty=fullName> and <xref:System.Data.Common.DbProviderServices.CreateDatabase%2A?displayProperty=fullName> methods|If the creation of database objects fails after an empty database is created, the method attempts to drop the database creation and propagates the original <xref:System.Data.SqlClient.SqlException> exception. If the attempt to drop the database fails, the method throws an <xref:System.InvalidOperationException> exception.|This change prevents the creation of an empty, unusable database. Exception handling can change somewhat, because the successful removal of the database now propagates the original <xref:System.Data.SqlClient.SqlException> exception.|  
|<xref:System.Data.Objects.ObjectContext.Translate%2A?displayProperty=fullName> and <xref:System.Data.Objects.ObjectContext.ExecuteStoreQuery%2A?displayProperty=fullName> methods|If `T` is an enumeration type, the method correctly returns data from the database.  Previously, enumeration types were not supported, so the result was always cast to zero or converted to the enumeration type. Underlying types that are not supported by the Entity Framework, such as <xref:System.UInt16>, <xref:System.UInt32>, and <xref:System.UInt64>; still return zero or are converted to the enumeration type with an underlying value of zero.|Support for enumerations is new in the Entity Framework in the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)]. However, if developer code depends on the result to be zero, an application error could result, depending on the specific code.|  
  
### LINQ  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|<xref:System.Linq.Enumerable.Empty%2A?displayProperty=fullName> method|The method returns a cached internal instance instead of returning a new <xref:System.Collections.Generic.IEnumerable%601> type.|This change results in a performance improvement. However, code that depends on getting two unique empty types from multiple calls to <xref:System.Linq.Enumerable.Empty%2A?displayProperty=fullName> will fail.|  
  
<a name="network"></a>   
## Networking  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|Types and members of the <xref:System.Net.PeerToPeer.Collaboration?displayProperty=fullName> namespace|The types and members are not supported on [!INCLUDE[win8](../../../includes/win8-md.md)]. Attempting to call them throws a <xref:System.PlatformNotSupportedException> exception.|Applications can no longer use these types and members on [!INCLUDE[win8](../../../includes/win8-md.md)].|  
|Serialization and deserialization of <xref:System.Net.Mail.MailMessage> objects.|In the .NET Framework 4.5, mail messages can include non-ASCII characters. In the .NET Framework 4, only ASCII characters are supported.|<xref:System.Net.Mail.MailMessage> objects that contain non-ASCII characters and that are serialized under the .NET Framework 4.5 cannot be deserialized under the .NET Framework 4.|  
  
<a name="Printing"></a>   
## Printing  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|<xref:System.Printing.PrintSystemJobInfo.JobStream%2A?displayProperty=fullName>|This property exposes the stream of a print job and allows the user to send raw data to the underlying operating system printing components by writing to this stream.<br /><br /> Starting with the .NET Framework 4.5 on Windows 8 and later versions of the Windows operating system, data written to this stream must be in XPS format as a package stream.|To output print content, you can do either of the following:<br /><br /> Use the <xref:System.Windows.Xps.XpsDocumentWriter> class to output print content. This is the recommended alternative.<br /><br /> Ensure the data sent to the stream returned by  the <xref:System.Printing.PrintSystemJobInfo.JobStream%2A?displayProperty=fullName> property is in XPS format as a package stream.|  
  
<a name="serialize"></a>   
## Serialization  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|Serialization with the <xref:System.Xml.Serialization.XmlSerializer> class|In WCF 4.5, the <xref:System.Xml.Serialization.XmlSerializer> class was optimized to remove its dependency on the C# compiler. This change provides significant performance gains for cold startup scenarios.|This change may cause problems in XML serialization code that was compiled in WCF 4 but is running against WCF 4.5. If you encounter any problems running your existing XML serialization code in WCF 4.5, use the following configuration element to revert to the XmlSerializer behavior in WCF 4:<br /><br /> `<configuration>    <system.xml.serialization>    <xmlSerializer useLegacySerializerGeneration="true"/>    </system.xml.serialization> </configuration>`|  
|Serialization and deserialization with the <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter?displayProperty=fullName> class|Serialization using <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter> can encode an object’s internal state, which is not guaranteed to be the same between versions of the .NET Framework.  Where there are differences, content serialized in one version of the .NET Framework may fail to deserialize on others.|The <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter> class does not guarantee cross-version compatibility. Use the <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter?displayProperty=fullName> and <xref:System.Runtime.Serialization.NetDataContractSerializer?displayProperty=fullName> classes instead.|  
  
<a name="tools"></a>   
## Tools and Resources  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|MSBuild|When you run MSBuild at a command prompt, it will respect solution configuration files that disable builds of particular projects.|MSBuild behaves the same when called by Visual Studio and when run at a command prompt. You do not have to create separate solutions or remove projects from a solution to build a subset of projects in a solution.|  
|MSBuild|The `TreatAsLocalProperty` property in MSBuild project files prevents specific properties, including the `OutDir` property, from being overridden at a global level.|Overrides to the `OutDir` property may cause a potential break if `OutDir` is a global property that is overridden after the MS.Common.Targets file is imported.|  
|Windows error reporting: Watson buckets|Managed crashes are grouped into categories based on a number of criteria, one of which was the assembly version. In the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], the file version is used instead of the assembly version.|Because the assembly version changes only between major releases, using the file version instead of the assembly version as a category makes it possible to determine the specific version of an assembly that has been involved in a managed crash.|  
|MSBuild|Data from projects in the <xref:Microsoft.Build.Evaluation.ProjectCollection?displayProperty=fullName> collection is not automatically reclaimed by the garbage collector.|If you explicitly load projects into the <xref:Microsoft.Build.Evaluation.ProjectCollection> collection, you should call the <xref:Microsoft.Build.Evaluation.ProjectCollection.UnloadProject%28Microsoft.Build.Evaluation.Project%29> method for each member of the collection.|  
  
<a name="asp"></a>   
## ASP.NET  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|ASP.NET IIS registration tool (aspnet_regiis.exe)|On [!INCLUDE[win8](../../../includes/win8-md.md)], the `–i` and `–u` options to install and uninstall ASP.NET are not supported.|To install or uninstall ASP.NET 4.5 with IIS 8,  use the **Turn Windows Features On/Off** dialog box, the Server Management tool, or the `dism.exe` command-line tool.|  
|<xref:System.Web.UI.WebControls.EntityDataSource?displayProperty=fullName> control|The <xref:System.Web.UI.Page.LoadComplete?displayProperty=fullName> event no longer causes the <xref:System.Web.UI.WebControls.EntityDataSource?displayProperty=fullName> control to invoke data binding for changes to create/update/delete parameters.|This change eliminates an extraneous trip to the database, prevents the values of controls from being reset, and produces behavior that is consistent with other data controls, such as <xref:System.Web.UI.WebControls.SqlDataSource> and <xref:System.Web.UI.WebControls.ObjectDataSource>. This change produces different behavior in the unlikely event that applications rely on invoking data binding in the <xref:System.Web.UI.Page.LoadComplete?displayProperty=fullName> event.|  
|<xref:System.Net.WebUtility.HtmlDecode%2A?displayProperty=fullName>, <xref:System.Net.WebUtility.UrlDecode%2A?displayProperty=fullName>, and [System.Web.Helpers.Json.Decode](https://msdn.microsoft.com/library/system.web.helpers.json.decode.aspx) methods|By default, decoding methods no longer decode an invalid input sequence into an invalid UTF-16 string. Instead, they return the original input.|The change in decoder output should matter only if you store binary data instead of UTF-16 data in strings. To explicitly control this behavior, set the `aspnet:AllowRelaxedUnicodeDecoding` attribute of the [\<appSettings>](http://msdn.microsoft.com/en-us/0d65a3f1-c522-423d-89b6-44921b6daebb) element to `true` to enable legacy behavior or to `false` to enable the current behavior.|  
|<xref:System.Net.WebUtility.HtmlEncode%2A?displayProperty=fullName> method|For applications that target the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], characters that are outside the Basic Multilingual Plane (BMP) round-trip correctly when they are passed to the <xref:System.Net.WebUtility.HtmlDecode%2A?displayProperty=fullName> method.|This change should have no effect on current applications. To restore the original behavior, set the `targetFramework` attribute of the [\<httpRuntime>](http://msdn.microsoft.com/library/e1f13641\(v=vs.100\).aspx) element to a string other than "4.5". You can also set the `unicodeEncodingConformance` and `unicodeDecodingConformance` attributes of the `<webUtility>` configuration element to control this behavior independently of the targeted version of the .NET Framework.|  
|<xref:System.Web.HttpRequest.ContentEncoding%2A?displayProperty=fullName> property|UTF-7 encoding is prohibited.|Data for applications that depend on incoming UTF-7 data will not decode properly in some cases. This should be rare, but you can restore legacy behavior by using the `aspnet:AllowUtf7RequestContentEncoding` attribute of the [\<appSettings>](http://msdn.microsoft.com/en-us/0d65a3f1-c522-423d-89b6-44921b6daebb) element.|  
|<xref:System.Web.HttpUtility.JavaScriptStringEncode%2A?displayProperty=fullName>|Starting with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], the method escapes the ampersand (&) character.|If your app depends on the previous behavior of this method, you can add an `aspnet:JavaScriptDoNotEncodeAmpersand` setting to the [ASP.NET appSettings element](http://msdn.microsoft.com/en-us/bb60e711-0669-4118-a54d-8dd71e009a00) in your configuration file.|  
|<xref:System.Web.Security.MachineKey.Encode%2A?displayProperty=fullName> and <xref:System.Web.Security.MachineKey.Decode%2A?displayProperty=fullName> methods|These methods are now obsolete.|Compilation of code that calls these methods produces a compiler warning. The recommended alternatives are <xref:System.Web.Security.MachineKey.Protect%2A?displayProperty=fullName> and <xref:System.Web.Security.MachineKey.Unprotect%2A?displayProperty=fullName>.|  
  
<a name="ClickOnce"></a>   
## ClickOnce  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|Apps published with ClickOnce that use a SHA-256 code-signing certificate.|The executable is signed with SHA256. Previously, it was signed with SHA1 regardless of whether the code-signing certificate was SHA-1 or SHA-256. This applies to:<br /><br /> All applications built with Visual Studio 2012 or later.<br /><br /> Applications built with Visual Studio 2010 or earlier on systems with the .NET Framework 4.5 present.<br /><br /> In addition, if the .NET Framework 4.5 or later is present, the ClickOnce manifest is also signed with SHA-256 for SHA-256 certificates regardless of the .NET Framework version against which it was compiled.|The change in signing the ClickOnce executable affects only Windows Server 2003 systems; they require that [KB 938397](http://support.microsoft.com/kb/938397) be installed.<br /><br /> The change in signing the manifest with SHA-256 even when an app targets the .NET Framework 4 or earlier versions introduces a runtime dependency on the .NET Framework 4.5 or a later version. This issue is resolved in Visual Studio 2013 Update 3 and in [!INCLUDE[net_v46](../../../includes/net-v46-md.md)]. For the [!INCLUDE[net_v46](../../../includes/net-v46-md.md)] resolution, see [Runtime Changes](../../../docs/framework/migration-guide/runtime-changes-in-the-net-framework-4-6.md).|  
  
<a name="mef"></a>   
## Managed Extensibility Framework (MEF)  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|<xref:System.ComponentModel.Composition.Primitives.ComposablePartCatalog?displayProperty=fullName> and its derived classes|Starting with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], MEF catalogs implement <xref:System.Collections.IEnumerable> and therefore can no longer be used to create a serializer (<xref:System.Xml.Serialization.XmlSerializer> object).|Trying to serialize a MEF catalog throws an exception.|  
  
<a name="web"></a>   
## Web Applications  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|Managed browser hosting controls from the .NET Framework 1.1 and 2.0|Hosting these controls is blocked in Internet Explorer.|Internet Explorer will fail to launch an application that uses managed browser hosting controls. The previous behavior can be restored by setting the EnableIEHosting value of the registry subkey HKLM/SOFTWARE/MICROSOFT/.NETFramework to 1 for x86 systems and for 32-bit processes on x64 systems, and by setting the EnableIEHosting value of the registry subkey HKLM/SOFTWARE/Wow6432Node/Microsoft/.NETFramework to 1 for 64-bit processes on x64 systems.|  
  
<a name="wcf"></a>   
## Windows Communication Foundation (WCF)  
 In addition to the following application compatibility issues, see the [Serialization](#serialize) section for serialization-related issues.  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|Messages in WCF web services hosted in Internet Information Services (IIS) or ASP.NET Development Server that exceed `maxRequestLength` (in ASP.NET) or `maxReceivedMessageSize` (in WCF)|The HTTP status code has changed from 400 (Bad Request) to 413 (Request Entity Too Large), and messages that exceed either the `maxRequestLength` or the `maxReceivedMessageSize` setting throw a <xref:System.ServiceModel.ProtocolException> exception. This includes cases in which the transfer mode is <xref:System.ServiceModel.TransferMode>.|This change facilitates debugging in cases where the message length exceeds the limits allowed by ASP.NET or WCF.<br /><br /> You must modify any code that performs processing based on an HTTP 400 status code.|  
|`Replace` in OData URLs|The `Replace` method in OData URLs is disabled by default.|When OData `Replace` is disabled (now by default), the user request will throw an exception and the request will fail.|  
|<xref:System.ServiceModel.Web.WebServiceHost?displayProperty=fullName>|The <xref:System.ServiceModel.Web.WebServiceHost?displayProperty=fullName> object no longer adds a default endpoint if an explicit endpoint has been added by application code.|If a client application tries to connect to an endpoint that is no longer added by default, an HTTP error results.|  
  
<a name="winForms"></a>   
## Windows Forms  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|System.Drawing.dll|The `CheckForOverflowUnderflow` property for the assembly is set to `true`.|Previously when overflows occurred, the result would be silently truncated. Now an <xref:System.OverflowException> exception is thrown.|  
|<xref:System.Drawing.Imaging.EncoderParameter.%23ctor%28System.Drawing.Imaging.Encoder%2CSystem.Int32%2CSystem.Int32%2CSystem.Int32%29?displayProperty=fullName> constructor|The constructor has been deprecated.|The constructor does not work on 64-bit systems. Use the <xref:System.Drawing.Imaging.EncoderParameter.%23ctor%28System.Drawing.Imaging.Encoder%2CSystem.Int32%2CSystem.Drawing.Imaging.EncoderParameterValueType%2CSystem.IntPtr%29?displayProperty=fullName> constructor instead.|  
  
<a name="wpf"></a>   
## Windows Presentation Foundation (WPF)  
 In addition to the following application compatibility issues, see the [Serialization](#serialize) section for serialization-related issues.  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|<xref:System.Windows.Controls.Primitives.TextBoxBase.UndoLimit%2A?displayProperty=fullName> property|The default limit to the maximum number of undo operations for the <xref:System.Windows.Controls.TextBox> and <xref:System.Windows.Controls.RichTextBox> classes has changed from -1 (no limit) to 100.|This change should have no negative impact. However, you can explicitly set the <xref:System.Windows.Controls.Primitives.TextBoxBase.UndoLimit%2A> property after instantiating the control.|  
|<xref:System.Windows.Controls.PageRangeSelection?displayProperty=fullName> enumeration|The <xref:System.Windows.Controls.PageRangeSelection> and <xref:System.Windows.Controls.PageRangeSelection> members have been added to the enumeration.|This change should have no impact on existing applications. The default is <xref:System.Windows.Controls.PageRangeSelection?displayProperty=fullName> for existing members that use this enumeration.|  
|<xref:System.Windows.DataTemplate> elements|<xref:System.Windows.DataTemplate> elements now appear in the control view of the UI Automation (UIA) tree.|This change improves accessibility. However, it affects test tools that rely on the previous structure of the UIA tree to locate neighboring elements.|  
|Synchronization of the <xref:System.Windows.Controls.TextBox.Text%2A?displayProperty=fullName> property and the property to which it is bound|In some cases, the <xref:System.Windows.Controls.TextBox.Text%2A?displayProperty=fullName> property reflects a previous value of the databound property value if the property is modified during a databinding write operation.|This should have no negative impact. However, you can restore the previous behavior by setting the <xref:System.Windows.FrameworkCompatibilityPreferences.KeepTextBoxDisplaySynchronizedWithTextProperty%2A?displayProperty=fullName> property to `false`.|  
|<xref:System.Windows.Controls.TextBox?displayProperty=fullName> property|When a <xref:System.Windows.Controls.TextBox?displayProperty=fullName> control is inactive, selected text inside the box displays in a different color than when the text box is active.|You can restore the previous behavior by setting the <xref:System.Windows.FrameworkCompatibilityPreferences.AreInactiveSelectionHighlightBrushKeysSupported%2A?displayProperty=fullName> property to `false`.|  
|<xref:System.Windows.Controls.Primitives.MultiSelector.SelectedItems%2A?displayProperty=fullName>|If a control derived from <xref:System.Windows.Controls.Primitives.MultiSelector> with <xref:System.Windows.Controls.Primitives.MultiSelector.CanSelectMultipleItems%2A> set to `true` has duplicates in its <xref:System.Windows.Controls.Primitives.MultiSelector.SelectedItems%2A?displayProperty=fullName> collection, the duplicated items appear more than once. Removing these items from the data source (for example, by calling `Items.Clear`) fails to remove them from the <xref:System.Windows.Controls.Primitives.MultiSelector.SelectedItems%2A?displayProperty=fullName> collection; only the first instance is removed.<br /><br /> Subsequent use of  the <xref:System.Windows.Controls.Primitives.MultiSelector.SelectedItems%2A?displayProperty=fullName> collection, such as a call to `SelectedItems.Clear`,  can encounter problems, such as an <xref:System.ArgumentException>, because the <xref:System.Windows.Controls.Primitives.MultiSelector.SelectedItems%2A?displayProperty=fullName> collection contains items that are no longer in the data source.|This issue has been addressed in the [!INCLUDE[net_v462](../../../includes/net-v462-md.md)]. If a <xref:System.Windows.Controls.Primitives.MultiSelector.SelectedItems%2A?displayProperty=fullName> collection has duplicate items, you remove them from the data source, and you wish to continue working with the <xref:System.Windows.Controls.Primitives.MultiSelector.SelectedItems%2A?displayProperty=fullName> collection, upgrade to the [!INCLUDE[net_v462](../../../includes/net-v462-md.md)].|  
|<xref:System.Windows.Threading.DispatcherSynchronizationContext.CreateCopy%2A?displayProperty=fullName>|In the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], the method returns a reference to the current instance. In the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], it returns a new instance.|Code that assumes equal references indicate that the executing thread is in the correct context will now execute correctly. However, because of the change, code that calls <xref:System.Windows.Threading.DispatcherSynchronizationContext.CreateCopy%2A?displayProperty=fullName> should be tested.|  
|Monitoring `WM_POWERBROADCAST` messages by using a handler added by calling the <xref:System.Windows.Interop.HwndSource.AddHook%2A?displayProperty=fullName> method.|A window must explicitly register for `WM_POWERBROADCAST` notifications by passing its handle to the [RegisterPowerSettingNotification](https://msdn.microsoft.com/library/windows/desktop/aa373196.aspx) function. Through the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], WPF automatically did this for all windows. Starting with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], WPF automatically registers one special window, but does not automatically register most app windows.|Code that handles `WM_POWERBROADCAST` notifications does not execute.<br /><br /> To continue to receive `WM_POWERBROADCAST` notifications, call the [RegisterPowerSettingNotification](https://msdn.microsoft.com/library/windows/desktop/aa373196.aspx) function to register a WPF window (typically the main application window) for `WM_POWERBROADCAST` notifications. In WPF apps that you develop with C#, this also requires that you select the **Allow unsafe code** box on the project properties **Build** tab.<br /><br /> In addition, if you are registering a window that does not persist until application shutdown, you should unregister it by calling the [UnregisterPowerSettingNotification](https://msdn.microsoft.com/library/windows/desktop/aa373237.aspx) function and passing it the `HPOWERNOTIFY` handle returned by the call to the [RegisterPowerSettingNotification](https://msdn.microsoft.com/library/windows/desktop/aa373196.aspx) function.|  
  
<a name="wwf"></a>   
## Windows Workflow Foundation (WF)  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|System.Activities.dll security|The assembly is marked with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute>attribute.|Derived classes cannot be marked with the <xref:System.Security.SecurityCriticalAttribute>. Previously, derived types had to be marked with the <xref:System.Security.SecurityCriticalAttribute>. However, this change should have no real impact.|  
|WF 3.0 types and members|The types and members of WF 3.0 are now marked as obsolete.|Trying to compile source code that uses WF 3.0 types or members generates a compiler error. You should use the WF 4 types and members in the <xref:System.Activities>namespaces.|  
|<xref:System.Activities.Presentation.DragDropHelper?displayProperty=fullName> class|The <xref:System.Activities.Presentation.DragDropHelper> class includes new methods that support drag-and-drop operations with multiple objects. Existing drag-and-drop methods that support dragging a single object are obsolete. (For more information, see [What's Obsolete in the Class Library](../../../docs/framework/whats-new/whats-obsolete.md).)|Although the old methods have been deprecated, they continue to be supported by both the compiler and the common language runtime. However, the new methods offer greater functionality. The recommended replacements for some of the existing methods are as follows:<br /><br /> Use <xref:System.Activities.Presentation.DragDropHelper.DoDragMove%28System.Activities.Presentation.WorkflowViewElement%2CSystem.Windows.Point%29?displayProperty=fullName> instead of <xref:System.Activities.Presentation.DragDropHelper.DoDragMove%28System.Activities.Presentation.WorkflowViewElement%2CSystem.Windows.Point%29?displayProperty=fullName>.<br /><br /> Use <xref:System.Activities.Presentation.DragDropHelper.GetCompositeView%28System.Activities.Presentation.WorkflowViewElement%29> instead of <xref:System.Activities.Presentation.DragDropHelper.GetCompositeView%28System.Windows.DragEventArgs%29>.<br /><br /> Use <xref:System.Activities.Presentation.DragDropHelper.GetDraggedModelItems%28System.Windows.DragEventArgs%29> instead of <xref:System.Activities.Presentation.DragDropHelper.GetDraggedModelItem%28System.Windows.DragEventArgs%29>.<br /><br /> Use <xref:System.Activities.Presentation.DragDropHelper.GetDroppedObjects%28System.Windows.DependencyObject%2CSystem.Windows.DragEventArgs%2CSystem.Activities.Presentation.EditingContext%29> instead of <xref:System.Activities.Presentation.DragDropHelper.GetDroppedObject%28System.Windows.DependencyObject%2CSystem.Windows.DragEventArgs%2CSystem.Activities.Presentation.EditingContext%29>.|  
|Overload resolution of calls to the <xref:System.Windows.Threading.Dispatcher.Invoke%2A?displayProperty=fullName> method|The [!INCLUDE[net_v45](../../../includes/net-v45-md.md)] adds new overloads that include a parameter of type <xref:System.Action?displayProperty=fullName>. When existing code is recompiled, compilers may resolve calls to <xref:System.Windows.Threading.Dispatcher.Invoke%2A?displayProperty=fullName> methods that have a <xref:System.Delegate> parameter as calls to <xref:System.Windows.Threading.Dispatcher.Invoke%2A?displayProperty=fullName> methods with an <xref:System.Action?displayProperty=fullName> parameter.|If a call to a <xref:System.Windows.Threading.Dispatcher.Invoke%2A?displayProperty=fullName> overload with a <xref:System.Delegate> parameter is resolved as a call to a <xref:System.Windows.Threading.Dispatcher.Invoke%2A?displayProperty=fullName> overload with an <xref:System.Action?displayProperty=fullName> parameter, the following differences in behavior may occur:<br /><br /> If an exception occurs, the <xref:System.Windows.Threading.Dispatcher.UnhandledExceptionFilter?displayProperty=fullName> and <xref:System.Windows.Threading.Dispatcher.UnhandledException?displayProperty=fullName> events are not raised. Instead, exceptions are handled by the <xref:System.Threading.Tasks.TaskScheduler.UnobservedTaskException> event.<br /><br /> Calls to some members, such as <xref:System.Windows.Threading.DispatcherOperation.Result%2A?displayProperty=fullName>, block until the operation has completed.|  
|<xref:System.Activities.Expressions.Literal%601?displayProperty=fullName> class|The associated <xref:System.Windows.Markup.ValueSerializer> object will convert a  <xref:System.DateTime> or <xref:System.DateTimeOffset> object whose `Second` and `Millisecond` components are non-zero and (for a <xref:System.DateTime> value) whose <xref:System.DateTime.Kind%2A?displayProperty=fullName> property is not <xref:System.DateTimeKind> to property element syntax instead of a string.|This change allows <xref:System.DateTime> and <xref:System.DateTimeOffset> values to be round-tripped. Custom XAML parsers that assume that input XAML is in the attribute syntax will not function correctly.|  
  
<a name="xml"></a>   
## XML, XSLT  
  
|Feature|Change|Impact|  
|-------------|------------|------------|  
|`XDocument.Validate` method|If the <xref:System.Xml.Linq.LoadOptions?displayProperty=fullName> value is passed to the <xref:System.Xml.Linq.XDocument.Load%2A> method and a validation error occurs, the <xref:System.Xml.Schema.XmlSchemaException.LineNumber%2A?displayProperty=fullName> and <xref:System.Xml.Schema.XmlSchemaException.LinePosition%2A?displayProperty=fullName> properties now contain line information.|Exception-handling code that depends on the values of the <xref:System.Xml.Schema.XmlSchemaException.LineNumber%2A?displayProperty=fullName> and <xref:System.Xml.Schema.XmlSchemaException.LinePosition%2A?displayProperty=fullName> properties will no longer work.|  
|Loading XML files with <xref:System.Xml.XmlTextReader?displayProperty=fullName>|DTD entity expansion is limited to 10,000,000 characters.|Loading XML files without DTD entity expansion or with limited DTD entity expansion is unaffected. Files with DTD entities that expand to more than 10,000,000 characters fail to load, and now throw an exception.|  
|Forward compatibility mode for the <xref:System.Xml.Xsl.XslCompiledTransform?displayProperty=fullName> class|In the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], XSLT 1.0 forward compatibility had the following issues:<br /><br /> Loading a style sheet failed if its version was set to 2.0 and the parser encountered an unrecognized XSLT 1.0 construct.<br /><br /> The `xsl:sort` construct failed to sort data if the style sheet version was set to 1.1.<br /><br /> In the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], these issues have been fixed, and XSLT 1.0 forward compatibility mode works properly.|XSLT 1.0 forward compatibility mode now works as previously.|  
|Exception messages when an XSLT file is too complex|In the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], the text of the error message when an XSLT file is too complex is "The style sheet is too complex." In previous versions, the error message was "XSLT compile error."|Application code that depends on the text of the error message will no longer work. However,  the exception types remain the same, so this change should have no real impact.|  
|XML schema validation for xsd:anyURI|In the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)], XML schema validation is more strict. If you use xsd:anyURI to validate a URI such as a mailto protocol, validation fails if there are spaces in the URI. In previous versions of the .NET Framework, validation succeeded.|The change affects only applications that target the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].|  
  
## See Also  
 [What's Obsolete in the Class Library](../../../docs/framework/whats-new/whats-obsolete.md)   
 [What's New](../../../docs/framework/whats-new/index.md)   
 [Application Compatibility](../../../docs/framework/migration-guide/application-compatibility.md)   
 [Application Compatibility in 4.5.1](../../../docs/framework/migration-guide/application-compatibility-in-the-net-framework-4-5-1.md)   
 [Application Compatibility in 4.5.2](../../../docs/framework/migration-guide/application-compatibility-in-the-net-framework-4-5-2.md)