---
title: ".NET Framework 4 migration issues"
description: Learn about migration issues between .NET Framework 3.5 Service Pack 1 and .NET Framework 4, including fixes and changes for standards compliance and security.
ms.date: "05/02/2017"
helpviewer_keywords:
  - ".NET Framework 4, migration"
  - "application compatibility"
ms.assetid: df478548-8c05-4de2-8ba7-adcdbe1c2a60
---
# .NET Framework 4 migration issues

This article describes migration issues between .NET Framework version 3.5 Service Pack 1 and .NET Framework version 4, including fixes, changes for standards compliance and security, and changes based on customer feedback. Most of these changes do not require any programming modifications in your applications. For those that may involve modifications, see the **Recommended changes** column of the table. Notable changes are broken down by area, for example, ASP.NET and Windows Presentation Foundation (WPF).

For a higher-level overview of the issues in this article, see [Migration Guide to .NET Framework 4](/previous-versions/dotnet/netframework-4.0/ff657133(v=vs.100)).

For information about new features, see [What's New in .NET Framework 4](/previous-versions/dotnet/netframework-4.0/ms171868(v=vs.100)).

## ASP.NET and Web

Namespaces: <xref:System.Web>, <xref:System.Web.Mobile>, <xref:System.Web.Security>, <xref:System.Web.UI.WebControls>

Assembly: System.Web (in System.Web.dll)

| Feature  | Differences from 3.5 SP1 | Recommended changes |
| -------- | ------------------------ | ------------------- |
| **Browser definition files** | The browser definition files have been updated to include information about new and updated browsers and devices. Older browsers and devices such as Netscape Navigator have been removed, and newer browsers and devices such as Google Chrome and Apple iPhone have been added.<br><br>If your application contains custom browser definitions that inherit from one of the browser definitions that have been removed, you will see an error.<br><br>The <xref:System.Web.HttpBrowserCapabilities> object (which is exposed by the page's `Request.Browse` property) is driven by the browser definition files. Therefore, the information that is returned by accessing a property of this object in ASP.NET 4 might be different than the information that was returned in an earlier version of ASP.NET. | If your application relies on the old browser definition files, you can copy them from the following folder:<br><br>*Windows\\Microsoft.NET\\Framework\\v2.0.50727\\CONFIG\\Browsers*<br><br>Copy the files into the corresponding *\\CONFIG\\Browsers* folder for ASP.NET 4. After you copy the files, run the [Aspnet_regbrowsers.exe](/previous-versions/dotnet/netframework-3.5/ms229858(v=vs.90)) command-line tool. For more information, see the [https://www.asp.net/mobile](/aspnet/mobile/overview) Web site. |
| **Child applications running under mixed versions of ASP.NET** | ASP.NET 4 applications that are configured as children of applications that run earlier versions of ASP.NET might fail to start because of configuration or compilation errors. The specific error that occurs depends on whether the application runs under IIS 6.0, or under IIS 7 or IIS 7.5. | You can make changes to the configuration files of the affected applications so that the configuration system correctly recognizes the ASP.NET 4 application. For information about the changes you must make, see the section "ASP.NET 4 Child Applications Fail to Start When Under ASP.NET 2.0 or ASP.NET 3.5 Applications" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site. |
| **ClientID changes** | The new `clientIDMode` setting in ASP.NET 4 lets you specify how ASP.NET generates the `id` attribute for HTML elements. In previous versions of ASP.NET, the default behavior was equivalent to the `AutoID` setting of `clientIDMode`. The default setting is now `Predictable`. For more information, see [ASP.NET Web Server Control Identification](/previous-versions/aspnet/1d04y8ss(v=vs.100)). | If you use Visual Studio to upgrade your application from ASP.NET 2.0 or ASP.NET 3.5, the tool automatically adds a setting to the Web.config file that preserves the behavior of earlier versions of .NET Framework. However, if you upgrade an application by changing the application pool in IIS to target .NET Framework 4, ASP.NET uses the new mode by default. To disable the new client ID mode, add the following setting to the Web.config file:<br><br>`<pages clientIDMode="AutoID" />` |
| **Code access security (CAS)** | ASP.NET 2.0 NET features that were added in ASP.NET 3.5 use the .NET Framework 1.1 and .NET Framework 2.0 code access security (CAS) model. However, the implementation of CAS in ASP.NET 4 has been substantially overhauled. As a result, partial-trust ASP.NET applications that rely on trusted code running in the global assembly cache might fail with various security exceptions. Partial-trust applications that rely on extensive modifications to machine CAS policy might also fail and throw security exceptions. | You can revert partial-trust ASP.NET 4 applications to the behavior of ASP.NET 1.1 and 2.0 by using the new `legacyCasModel` attribute in the `trust` configuration element, as shown in the following example:<br><br>`<trust level= "Medium" legacyCasModel="true" />`<br><br>Important: Reverting to the older CAS model might represent reduced security.<br><br>For more information about the new ASP.NET 4 code access security model, see [Code Access Security in ASP.NET 4 Applications](/previous-versions/dd984947(v=vs.100)). |
| **Configuration files** | The root configuration files (the machine.config file and the root Web.config file) for .NET Framework and ASP.NET 4 have been updated to include most of the boilerplate configuration information that was found in the application Web.config files in ASP.NET 3.5. Because of the complexity of the managed IIS 7 and IIS 7.5 configuration systems, running ASP.NET 3.5 applications under ASP.NET 4 and under IIS 7 and IIS 7.5 can result in either ASP.NET errors or IIS errors. | Upgrade ASP.NET 3.5 applications to ASP.NET 4 by using the project upgrade tools in Visual Studio. Visual Studio 2010 automatically modifies the ASP.NET 3.5 application's Web.config file to contain the appropriate settings for ASP.NET 4.<br><br>However, you can run ASP.NET 3.5 applications using .NET Framework 4 without recompilation. In that case, you might have to manually modify the application's Web.config file before you run the application under .NET Framework 4 and under IIS 7 or IIS 7.5. The specific change you must make depends on the combination of software you are working with, including Service Pack (SP) releases. For information about the possible software combinations that are affected by this change and how to resolve problems with specific combinations, see the section "Configuration Errors Related to New ASP.NET 4 Root Configuration" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site. |
| **Control rendering** | In previous versions of ASP.NET, some controls emitted markup that you could not disable. By default, this type of markup is no longer generated in ASP.NET 4. The rendering changes affect the following controls:<br><br>\* The `Image` and `ImageButton` controls no longer render a `border="0"` attribute.<br>\* The `BaseValidator` class and validation controls that derive from it no longer render red text by default.<br>\* The `HtmlForm` control does not render a `name` attribute.<br>\* The `Table` control no longer renders a `border="0"` attribute.<br><br>Controls that are not designed for user input (for example, the `Label` control) no longer render the `disabled="disabled"` attribute if their `Enabled` property is set to `false` (or if they inherit this setting from a container control). | If you use Visual Studio to upgrade your application from ASP.NET 2.0 or ASP.NET 3.5, the tool automatically adds a setting to the Web.config file that preserves legacy rendering. However, if you upgrade an application by changing the application pool in IIS to target .NET Framework 4, ASP.NET uses the new rendering mode by default. To disable the new rendering mode, add the following setting to the Web.config file:<br><br>`<pages controlRenderingCompatibilityVersion="3.5" />` |
| **Event handlers in default documents** | ASP.NET  4 renders the HTML `form` element's `action` attribute value as an empty string when a request is made to an extensionless URL that has a default document mapped to it. In earlier releases of ASP.NET, a request to `http://contoso.com` would result in a request to Default.aspx. In that document, the opening `form` tag would be rendered as in the following example:<br><br>`<form action="Default.aspx" />`<br><br>In ASP.NET 4, a request to `http://contoso.com` also results in a request to Default.aspx, but ASP.NET now renders the HTML opening `form` tag as in the following example:<br><br>`<form action="" />`<br><br>When the `action` attribute is an empty string, the IIS `DefaultDocumentModule` object creates a child request to Default.aspx. Under most conditions, this child request is transparent to application code, and the Default.aspx page runs normally. However, a potential interaction between managed code and IIS 7 or IIS 7.5 Integrated mode can cause managed .aspx pages to stop working properly during the child request. If the following conditions occur, the child request to a default .aspx document will result in an error or in unexpected behavior:<br><br>\* An .aspx page is sent to the browser with the `form` element's `action` attribute set to "".<br>\* The form is posted back to ASP.NET.<br>\* A managed HTTP module reads some part of the entity body, such as `Request.Form` or `Request.Params`. This causes the entity body of the POST request to be read into managed memory. As a result, the entity body is no longer available to any native code modules that are running in IIS 7 or IIS 7.5 Integrated mode.<br>\* The IIS `DefaultDocumentModule` object eventually runs and creates a child request to the Default.aspx document. However, because the entity body has already been read by a piece of managed code, there is no entity body available to send to the child request.<br>\* When the HTTP pipeline runs for the child request, the handler for .aspx files runs during the handler-execute phase.<br><br>Because there is no entity body, there are no form variables and no view state. Therefore there is no information available for the .aspx page handler to determine what event (if any) should be raised. As a result, none of the postback event handlers for the affected .aspx page run. | For information about ways to work around problems that might arise as a result of this change, see "Event Handlers Might Not Be Not Raised in a Default Document in IIS 7 or IIS 7.5 Integrated Mode" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site. |
| **Hashing algorithm** | ASP.NET uses both encryption and hashing algorithms to help secure data such as forms authentication cookies and view state. By default, ASP.NET 4 uses the <xref:System.Security.Cryptography.HMACSHA256> algorithm for hash operations on cookies and view state. Earlier versions of ASP.NET used the older <xref:System.Security.Cryptography.HMACSHA1> algorithm. | If you run applications that mix ASP.NET 2.0 and ASP.NET 4, where data such as forms authentication cookies must work across .NET Framework versions, configure an ASP.NET 4 Web application to use the older <xref:System.Security.Cryptography.HMACSHA1> algorithm by adding the following setting in the Web.config file:<br><br>`<machineKey validation="SHA1" />` |
| **Hosting controls in Internet Explorer** | You can no longer host Windows Forms controls in the Internet Explorer, because there are better solutions for hosting controls on the Web. Therefore, the IEHost.dll and IEExec.exe assemblies have been removed from .NET Framework. | You can use the following technologies for custom control development in Web applications:<br><br>\* You can create a Silverlight application and configure it to run outside the browser. For more information, see [Out-of-Browser Support](/previous-versions/windows/silverlight/dotnet-windows-silverlight/dd550721(v=vs.95)).<br>\* You can build a XAML browser application (XBAP) to take advantage of WPF capabilities (requires .NET Framework on client machines). For more information, see [WPF XAML Browser Applications Overview](/dotnet/desktop/wpf/app-development/wpf-xaml-browser-applications-overview). |
| **HtmlEncode and UrlEncode methods** | The `HtmlEncode` and `UrlEncode` methods of the <xref:System.Web.HttpUtility> and <xref:System.Web.HttpServerUtility> classes have been updated to encode the single quotation mark character (') as follows:<br><br>\* The `HtmlEncode` method encodes instances of the single quotation mark as `&#39;`<br>\* The `UrlEncode` method encodes instances of the single quotation mark as `%27` | Examine your code for places where you use the `HtmlEncode` and `UrlEncode` methods, and make sure that the change in encoding does not result in a change that would affect your application. |
| **HttpException errors in ASP.NET 2.0 applications** | After ASP.NET 4 has been enabled on IIS 6, ASP.NET 2.0 applications that run on IIS 6 (in either Windows Server 2003 or Windows Server 2003 R2) might generate errors such as the following: `System.Web.HttpException: Path '/[yourApplicationRoot]/eurl.axd/[Value]' was not found.` | * If ASP.NET 4 is not required in order to run the Web site, remap the site to use ASP.NET 2.0 instead.<br><br>-or-<br><br>\* If ASP.NET 4 is required in order to run the Web site, move any child ASP.NET 2.0 virtual directories to a different Web site that is mapped to ASP.NET 2.0.<br><br>-or-<br><br>\* Disable extensionless URLs. For more information, see "ASP.NET 2.0 Applications Might Generate HttpException Errors That Reference eurl.axd" in the document [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) on the ASP.NET Web site. |
| **Membership types** | Some types (for example, <xref:System.Web.Security.MembershipProvider>) that are used in ASP.NET membership have been moved from System.Web.dll to the System.Web.ApplicationServices.dll assembly. The types were moved in order to resolve architectural layering dependencies between types in the client and in extended .NET Framework SKUs. | Class libraries that have been upgraded from earlier versions of ASP.NET and that use membership types that have been moved might fail to compile when used in an ASP.NET 4 project. If so, add a reference in the class library project to System.Web.ApplicationServices.dll. |
| **Menu control changes** | Changes to the <xref:System.Web.UI.WebControls.Menu> control result in the following behavior:<br><br>\* If <xref:System.Web.UI.WebControls.MenuRenderingMode> is set to `List`, or if <xref:System.Web.UI.WebControls.MenuRenderingMode> is set to `Default` and <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> is set to `4.0` or later, the <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> property has no effect.<br>\* If the path that is set in the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> and <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> properties contains a backslash (\\), the images do not render. (In earlier versions of ASP.NET, the path could include a backslash.) | * Instead of setting the <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> property for individual menu items, set the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> or <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> of the parent <xref:System.Web.UI.WebControls.Menu> control.<br><br>-or-<br><br>Set <xref:System.Web.UI.WebControls.MenuRenderingMode> to `Table`, or set <xref:System.Web.UI.WebControls.MenuRenderingMode> to `Default` and set <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> to `3.5`. These settings cause the <xref:System.Web.UI.WebControls.Menu> control to use the HTML table-based layout that it used in earlier versions of ASP.NET.<br>\* If the path in the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> or <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> property contains a backslash (\\), substitute a slash character (/). |
| **Mobile assembly in Web.config file** | In previous versions of ASP.NET, a reference to the System.Web.Mobile.dll assembly was included in the root Web.config file in the `assemblies` section under `system.web`/`compilation`. To improve performance, the reference to this assembly has been removed.<br><br>Note: The System.Web.Mobile.dll assembly and the ASP.NET mobile controls are included in ASP.NET 4, but they are deprecated. | If you want to use types from this assembly, add a reference to the assembly in either the root Web.config file or in an application Web.config file. |
| **Output caching** | In ASP.NET 1.0, a bug caused cached pages that specified `Location="ServerAndClient"` as an output&euro;"cache setting to emit a `Vary:*` HTTP header in the response. This had the effect of telling client browsers to never cache the page locally. In ASP.NET 1.1, the <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> method was added, which could be called in order to suppress the `Vary:*` header. However, bug reports suggest that developers are unaware of the existing `SetOmitVaryStar` behavior.<br><br>In ASP.NET 4, the `Vary:*` HTTP header is no longer emitted from responses that specify the following directive:<br><br>`<%@ OutputCache Location="ServerAndClient" %>`<br><br>As a result, the <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> method is no longer needed in order to suppress the `Vary:*` header. In applications that specify "ServerAndClient" for the `Location` attribute, pages will be cacheable in the browser without requiring that you call <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>. | If pages in the application must emit `Vary:*`, call the <xref:System.Web.HttpResponse.AppendHeader%2A> method as shown in the following example:<br><br>`System.Web.HttpResponse.AppendHeader("Vary","*");`<br><br>Alternatively, you can change the value of the output caching `Location` attribute to "Server". |
| **Page parsing** | The page parser for ASP.NET Web pages (.aspx files) and user controls (.ascx files) is stricter in ASP.NET 4 than in earlier versions of ASP.NET, and it flags more markup as invalid than in earlier versions. | Examine error messages that are produced when a page runs and fix errors that result from invalid markup. |
| **Passport types** | The Passport support built into ASP.NET 2.0 is obsolete and is unsupported due to changes in Passport (now Live ID SDK). As a result, the types related to Passport in <xref:System.Web.Security> are now marked with the `ObsoleteAttribute` attribute. | Change any code that uses Passport types in the <xref:System.Web.Security> namespace (for example, <xref:System.Web.Security.PassportIdentity>) to use the Windows Live ID SDK. |
| **PathInfo information in the FilePath property** | ASP.NET 4 no longer includes the `PathInfo` value in the return values from properties such as <xref:System.Web.HttpRequest.FilePath>, <xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath>, and <xref:System.Web.HttpRequest.CurrentExecutionFilePath>. Instead, the `PathInfo` information is available in <xref:System.Web.HttpRequest.PathInfo>. For example, imagine the following URL fragment:<br><br>`/testapp/Action.mvc/SomeAction`<br><br>In earlier versions of ASP.NET, <xref:System.Web.HttpRequest> properties have the following values:<br><br>\* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc/SomeAction`<br>\* <xref:System.Web.HttpRequest.PathInfo>: (empty)<br><br>In ASP.NET 4, <xref:System.Web.HttpRequest> properties instead have the following values:<br><br>\* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc`<br>\* <xref:System.Web.HttpRequest.PathInfo>: `SomeAction` | Examine your code for places where you rely on properties of the <xref:System.Web.HttpRequest> class to return path information; change the code to reflect the changes in how path information is returned. |
| **Request validation** | To improve request validation, the ASP.NET request validation is invoked earlier in the request life cycle. As a result, request validation runs for requests that are not for .aspx files, such as for Web service calls and for custom handlers. Request validation will also be active when custom HTTP modules are running in the request processing pipeline.<br><br>As a result of this change, requests for resources other than .aspx files might throw request validation errors. Custom code that runs in the request pipeline (for example, custom HTTP modules) might also throw request validation errors. | If necessary, you can revert to the old behavior of having only .aspx pages triggering request validation by using the following setting in the Web configuration file:<br><br>`<httpRuntime requestValidationMode="2.0" />`<br><br>Warning: If you revert to the old behavior, make sure that all code in existing handlers, modules, and other custom code performs checks for potentially unsafe HTTP inputs that could be XSS attack vectors. |
| **Routing** | If you create a file system Web site in Visual Studio 2010 and the Web site is in a folder that contains a dot (.) in the folder name, URL routing will not work reliably. An HTTP 404 error is returned from some virtual paths. This occurs because Visual Studio 2010 launches the Visual Studio Development Server using an incorrect path for the root virtual directory. | * In the **Properties** page for the file-based Web site, change the **Virtual Path** attribute to "/".<br><br>-or-<br><br>\* Create a Web application project instead of a Web site project. Web application projects do not have this issue, and URL routing works even if the project folder has a dot in its name.<br><br>-or-<br><br>\* Create an HTTP-based Web site that is hosted in IIS. IIS-hosted Web sites can have dots in the virtual path as well as in the project file folder. |
| **SharePoint sites** | If you try to run an ASP.NET 4 Web site that is deployed as a child of a SharePoint Web site that contains a custom partial-trust level named `WSS_Minimal`, you will see the following error:<br><br>`Could not find permission set named 'ASP.Net'.` | Currently, no versions of SharePoint are compatible with ASP.NET. As a result, you should not attempt to run an ASP.NET 4 Web site as a child of a SharePoint Web site. |
| **XHTML 1.1 standards** | To enable XHTML 1.1 compliance for new Web sites, the ASP.NET controls in .NET Framework 4 will generate XHTML 1.1 compliant HTML. This rendering is enabled using the following option in the Web.config file inside the `<system.Web>` element:<br><br>`<pages controlRenderingCompatibilityVersion="4.0"/>`<br><br>This option is set by default to 4.0. Web projects that are upgraded from Visual Studio 2008 have the 3.5 setting enabled for compatibility. | None. |

## Core

### General features

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **CardSpace** | Windows CardSpace is no longer included in .NET Framework; it is provided separately. | Download Windows CardSpace from the [Microsoft Download Center](https://go.microsoft.com/fwlink/?LinkId=199868). |
| **Configuration files** | Corrections have been made in how .NET Framework accesses application configuration files. | If your application configuration file is named *application-name.config*, rename it to *application-name.exe.config*. For example, rename *MyApp.config* to *MyApp.exe.config*. |
| **C# code compiler** | The `Compiler`, `CompilerError`, and `ErrorLevel` classes that were in the <xref:Microsoft.CSharp> namespace are no longer available, and their assembly (cscompmgd.dll) is no longer included in .NET Framework. | Use the <xref:System.CodeDom.Compiler.CodeDomProvider> class and other classes in the <xref:System.CodeDom.Compiler> namespace. For more information, see [Using the CodeDOM](/previous-versions/dotnet/netframework-4.0/y2k85ax6(v=vs.100)). |
| **Hosting** (unmanaged API) | To improve hosting capabilities, some of the hosting activation APIs have been deprecated. In-process side-by-side execution features enable an application to load and start multiple versions of .NET Framework in the same process. For example, you can run applications that load add-ins (or components) that are based on .NET Framework 2.0 SP1 and add-ins that are based on .NET Framework 4 in the same process. Older components continue to use the older .NET Framework version, and new components use the new .NET Framework version. | Use the configurations described in [In-Process Side-by-Side Execution](../deployment/in-process-side-by-side-execution.md). |
| **New security model** | The code access security (CAS) policy has been turned off and replaced with a simplified model, as described in [Security Changes in .NET Framework 4](/previous-versions/dotnet/netframework-4.0/dd233103(v=vs.100)). | Modifications may be required if you depend on CAS in your applications. For more information, see [Code Access Security Policy Compatibility and Migration](/previous-versions/dotnet/framework/code-access-security/code-access-security-policy-compatibility-and-migration). |

### Date and time

Namespace: <xref:System>

Assembly: mscorlib (in mscorlib.dll)

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **Daylight savings** | To be consistent with the system clock, time properties (such as <xref:System.TimeZoneInfo.Local> and <xref:System.DateTime.Now>) now use operating system rules instead of other .NET Framework data for daylight saving time operations. | None. |
| **Formatting strings** | To support culture-sensitive formatting, the <xref:System.TimeSpan> structure includes new overloads of the `ToString`, `Parse`, and `TryParse` methods in addition to new `ParseExact` and `TryParseExact` methods. | None. |

### Globalization

For a list of new neutral and specific cultures, see [What's New in Globalization and Localization](/previous-versions/dotnet/netframework-4.0/dd997383(v=vs.100)).

Namespace: <xref:System.Globalization>

Assembly: mscorlib (in mscorlib.dll)

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **Culture names** | The following name changes affect the German, Divehi, and African cultures:<br><br>\* <xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>: The currency name for the German (Switzerland) (de-CH) culture has changed from "sFr." to "Fr.".<br>\* <xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>: The long date pattern for the Divehi (Maldives) (dv-MV) culture has changed from "dd/MMMM/yyyy" to "dd/MM/yyyy".<br>\* <xref:System.Globalization.DateTimeFormatInfo.PMDesignator>: The P.M. designator of the Afrikaans (South Africa) (af-ZA) culture has changed from "nm" to "PM". | Note culture name changes. |
| **LCID parameter** | To be consistent with expected behavior in automation server settings, the CLR no longer passes the current culture for the `LCID` parameter to unmanaged COM-based applications. Instead, it passes 1033 (en-us) for the culture. | No modifications necessary except for native applications that require a specified culture. |
| **Obsolete culture types** | The <xref:System.Globalization.CultureTypes> and <xref:System.Globalization.CultureTypes> culture types are now obsolete.<br><br>For backward compatibility, <xref:System.Globalization.CultureTypes> now returns neutral and specific cultures that were included with the previous .NET Framework, and <xref:System.Globalization.CultureTypes> now returns an empty list. | Use other values of the <xref:System.Globalization.CultureTypes> enumeration. |
| **Retrieving culture** | Beginning with Windows 7, .NET Framework 4 retrieves culture information from the operating system instead of storing the data itself. In addition, .NET Framework synchronizes with Windows for sorting and casing data. | None. |
| **Unicode 5.1 standards** | .NET Framework now supports all Unicode 5.1 characters -- an addition of approximately 1400 characters. The additional characters include new symbols, arrows, diacritics, punctuation, mathematical symbols, CJK strokes and ideographs, additional Malayalam and Telugu numeric characters, and various Myanmar, Latin, Arabic, Greek, Mongolian, and Cyrillic characters. The following new scripts are supported with Unicode 5.1: Sundanese, Lepcha, Ol Chiki, Vai, Saurashtra, Kayah Li, Rejang, Gurmukhi, Odia, Tamil, Telugu, and Malayalam characters and Cham. | None. |

### Exceptions

Namespaces: <xref:System>, <xref:System.Runtime.ExceptionServices>

Assembly: mscorlib (in mscorlib.dll)

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **Exceptions for corrupted process state** | The CLR no longer delivers exceptions for corrupted process state to exception handlers in managed code. | These exceptions indicate that the state of a process has been corrupted. We do not recommend that you run your application in this state.<br><br>For more information, see the <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> and the entry [Handling Corrupted State Exceptions](/archive/msdn-magazine/2009/february/clr-inside-out-handling-corrupted-state-exceptions) in the MSDN magazine. |
| **Execution engine exceptions** | <xref:System.ExecutionEngineException> is now obsolete, because a catchable exception will allow an unstable process to continue to run. This change improves predictability and reliability in the runtime. | Use an <xref:System.InvalidOperationException> to signal the condition. |

### Reflection

Namespace: <xref:System.Reflection>

Assembly: mscorlib (in mscorlib.dll)

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **Assembly hash algorithms** | The <xref:System.Reflection.AssemblyName.HashAlgorithm> property now returns <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm>, because the runtime does not know the hash algorithm of the referenced assembly when the assembly is not loaded. (This refers to using the property on a referenced assembly such as that returned by the <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A> method.) | None. |
| **Assembly loading** | To prevent redundant loading of assemblies and to save virtual address space, the CLR now loads assemblies by using only the Win32 `MapViewOfFile` function. It no longer also calls the `LoadLibrary` function.<br><br>This change affects diagnostic applications in the following ways:<br><br>\* A <xref:System.Diagnostics.ProcessModuleCollection> will no longer contain any modules from a class library (.dll file), as obtained from a call to `Process.GetCurrentProcess().Modules`.<br>\* Win32 applications that use the `EnumProcessModules` function will not see all managed modules listed. | None. |
| **Declaring type** | The <xref:System.Type.DeclaringType> property now correctly returns null when the type does not have a declaring type. | None. |
| **Delegates** | A delegate now throws an <xref:System.ArgumentNullException> instead of a <xref:System.NullReferenceException> when a null value is passed to the delegate's constructor. | Ensure that any exception handling catches <xref:System.ArgumentNullException>. |
| **Global assembly cache location change** | For .NET Framework 4 assemblies, the global assembly cache has been moved from the Windows directory (%WINDIR%) to the Microsoft.Net subdirectory (*%WINDIR%\\Microsoft.Net*). Assemblies from earlier versions remain in the older directory.<br><br>The unmanaged [ASM_CACHE_FLAGS](../unmanaged-api/fusion/asm-cache-flags-enumeration.md) enumeration contains the new `ASM_CACHE_ROOT_EX` flag. This flag gets the cache location for .NET Framework 4 assemblies, which can be obtained by the [GetCachePath](../unmanaged-api/fusion/getcachepath-function.md) function. | None, assuming that applications do not use explicit paths to assemblies, which is not a recommended practice. |
| **Global assembly cache tool** | The [Gacutil.exe (Global Assembly Cache Tool)](/previous-versions/dotnet/netframework-4.0/ex0ss12c(v=vs.100)) no longer supports the shell plugin viewer. | None. |

### Interoperability

Namespace: <xref:System.Runtime.InteropServices>

Assembly: mscorlib (in mscorlib.dll)

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **Buffer length** (unmanaged API) | To save memory, the functionality for the `pBufferLengthOffset` parameter for the [ICorProfilerInfo2::GetStringLayout](../unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method.md) method has been changed to match the `pStringLengthOffset` parameter. Both parameters now point to the offset location of the string's length. Buffer length has been removed from the representation of the string class. | Remove any dependency on the buffer length. |
| **JIT debugging** | To simplify registration for just-in-time (JIT) debugging, the .NET Framework debugger now uses only the AeDebug registry key, which controls the JIT debugging behavior for native code. This change results in the following:<br><br>\* You can no longer register two different debuggers for managed and native code.<br>\* You can no longer start the debugger automatically for a non-interactive process, but you can prompt the user for an interactive process.<br>\* You are no longer notified when the debugger fails to start, or when there is no registered debugger that should be started.<br>\* Auto-launch policies that depend on the interactivity of the application are no longer supported. | Adjust debugging operations as required. |
| **Platform invoke** | To improve performance in interoperability with unmanaged code, incorrect calling conventions in a platform invoke now cause the application to fail. In previous versions, the marshaling layer resolved these errors up the stack. | Debugging your applications in Microsoft Visual Studio alerts you to these errors so you can correct them.<br><br>If you have binaries that cannot be updated, you can include the [\<NetFx40_PInvokeStackResilience>](../configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element.md) element in your application's configuration file to enable calling errors to be resolved up the stack as in earlier versions. However, this may affect the performance of your application. |
| **Removed interfaces** (unmanaged API) | To avoid developer confusion, the following interfaces were removed, because they did not provide any useful run-time scenarios, and the CLR did not provide or accept any implementations:<br><br>\* **INativeImageINativeImageDependency**<br>\* **INativeImageInstallInfo**<br>\* **INativeImageEvaluate**<br>\* **INativeImageConverter**<br>\* **ICorModule**<br>\* **IMetaDataConverter** | None. |

## Data

This section describes migration issues for using data sets and SQL clients, the Entity Framework, LINQ to SQL, and WCF Data Servers (formerly known as ADO.NET Data Services).

### DataSet and SQL Client

The following table describes improvements to features that previously had limitations or other issues.

Namespaces: <xref:System.Data>, <xref:System.Data.Objects.DataClasses>, <xref:System.Data.SqlClient>

Assemblies: System.Data (in System.Data.dll), System.Data.Entity (in System.Data.Entity.dll)

| Feature | Differences from 3.5 SP1 |
| ------- | ------------------------ |
| **POCO Scenarios** | The <xref:System.Data.Objects.DataClasses.IRelatedEnd> interface has new methods to improve its usability in Plain Old CLR Object (POCO) scenarios. These new methods take an <xref:System.Object> instead of an <xref:System.Data.Objects.DataClasses.IEntityWithRelationships> entity as a parameter. |
| **Editing Rows** | The <xref:System.Collections.IList.IndexOf%2A> method, as implemented by the <xref:System.Data.DataView> class, now correctly returns the value of a row that is being edited, instead of returning -1. |
| **Events** | The <xref:System.Data.DataRowView.PropertyChanged> event is now raised when a row is in a modified state and the <xref:System.Data.DataRow.RejectChanges%2A> method is called. This change makes it easier to create UI controls that expose the contents of a <xref:System.Data.DataSet> object. |
| **Exceptions** | The <xref:System.Data.SqlClient.SqlCommand.Prepare%2A> method now throws an <xref:System.InvalidOperationException> when a connection is not set or open instead of a <xref:System.NullReferenceException>. |
| **Mapping Views** | Query view mapping errors are now caught at design time instead of throwing a <xref:System.NullReferenceException> at run time.<br><br>Mapping validation now catches the error in which two association sets in Conceptual Schema (CSDL) are mapped to the same column. |
| **Transactions** | If an application tries to execute a statement on a connection after a transaction has been completed (including aborted or rolled back), an <xref:System.InvalidOperationException> is now thrown. Previous versions did not throw an exception and let you execute additional commands even if a transaction was aborted. |

### Entity Framework

The following table describes improvements to features that previously had limitations or other issues.

Namespaces: <xref:System.Data>, <xref:System.Data.Objects>, <xref:System.Data.Objects.DataClasses>

Assemblies: System.Data.Entity (in System.Data.Entity.dll)

| Feature | Differences from 3.5 SP1 |
| ------- | ------------------------ |
| **Entity objects** | There is now parity between the <xref:System.Data.Objects.ObjectContext.Detach%2A> method and the state of the entity object when the <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> method is called. This improved consistency prevents unexpected exceptions from being thrown. |
| **Entity SQL** | Rules have been improved for identifier resolutions in Entity SQL.<br><br>The Entity SQL parser has improved logic for resolving multipart identifiers. |
| **Structural annotations** | The Entity Framework now recognizes structural annotations. |
| **Queries** | The following improvements were made in queries:<br><br>\* A `GroupBy` query using a null key over an empty collection will not return any rows, regardless if there are any additional selects in the query.<br>\* Generated SQL in LINQ and Entity-SQL queries now treat string parameters as non-Unicode values by default. |

### LINQ to SQL

The following table describes improvements to features that previously had limitations or other issues.

Namespace: <xref:System.Data.Linq>

Assembly: System.Data.Linq (in System.Data.Linq.dll)

| Feature | Differences from 3.5 SP1 |
| ------- | ------------------------ |
| **Events** | A <xref:System.Data.Linq.EntitySet%601> collection now raises the <xref:System.Data.Linq.EntitySet%601.ListChanged> event for add and remove operations if the <xref:System.Data.Linq.EntitySet%601> is unloaded, in addition to raising the event when the collection is loaded. |
| **Queries** | `Skip(0)` is no longer ignored in LINQ to SQL queries. As a result, queries that have this method might behave differently. For example, in some cases, an `OrderBy` clause is required with `Skip(0)`, and the query will now throw a <xref:System.NotSupportedException> exception if the `OrderBy` clause was not included. |

### WCF Data Services

The following table describes improvements to features that previously had limitations or other issues.

Namespaces: <xref:System.Data.Services>, <xref:System.Data.Services.Client>, <xref:System.Data.Services.Common>, <xref:System.Data.Services.Providers>

Assemblies: System.Data.Services (in System.Data.Services.dll), System.Data.Services.Client (in System.Data.Services.Client.dll)

| Feature | Differences from 3.5 SP1 |
| ------- | ------------------------ |
| **Batched Binary Content** | WCF Data Services now supports batched binary content in requests and responses. |
| **Change interceptors** | Change interceptors are now executed for a delete request.<br><br>A change interceptor is a method that runs every time a request is received by the server to modify an entity in the entity set. It runs before the incoming request is executed. The change interceptor provides access to the entity that is being changed and the operation that is being performed on it. |
| **Exceptions** | The following conditions now throw more useful exceptions instead of a <xref:System.NullReferenceException>:<br><br>\* A <xref:System.ServiceProcess.TimeoutException> when a call to a data service times out.<br>\* A <xref:System.Data.Services.Client.DataServiceRequestException> when a bad request is made to a data service.<br><br>In your applications, you should change exception handling to catch the new exceptions. |
| **Headers** | The following improvements were made to headers:<br><br>\* WCF Data Services now correctly rejects an `eTag` header that has an unspecified value.<br>\* WCF Data Services now returns an error and does not execute the request for a delete request to a link when an `if-*` header is in the request.<br>\* WCF Data Services now returns an error to the client in the format (Atom, JSON) that the client specified in the Accept header. |
| **JSON Reader** | The JavaScript Object Notation (JSON) reader now correctly returns an error when it reads the single backslash ("\\") escape character, when it processes JSON payloads sent to a WCF Data Service. |
| **Merges** | The following improvements were made to the <xref:System.Data.Services.Client.MergeOption> enumeration:<br><br>\* The <xref:System.Data.Services.Client.MergeOption> merge option no longer modifies the entity on the client as a result of any subsequent response from a data service.<br>\* The <xref:System.Data.Services.Client.MergeOption> option is now consistent between dynamic SQL and stored procedure-based updates. |
| **Requests** | The <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> method is now called before a request to data services is processed. This enables the request to work correctly for <xref:System.Data.Services.Providers.ServiceOperation> services. |
| **Streams** | WCF Data Services no longer closes the underlying stream for read and write operations. |
| **URIs** | The escaping of URIs by WCF Data Services client has been corrected. |

## Windows Communication Foundation (WCF)

The following table describes improvements to features that previously had limitations or other issues.

| Feature | Differences from 3.5 SP1 |
| ------- | ------------------------ |
| **Configuration files** | To enable inheritance of behaviors through the configuration file hierarchy, WCF now supports merging across configuration files.<br><br>The configuration inheritance model is now expanded to let users define behaviors that will be applied to all the services that are running on the computer.<br><br>You may encounter behavioral changes if there are behaviors with the same name at different levels of the hierarchy. |
| **Service hosting** | You can no longer specify the `<serviceHostingEnvironment>` configuration element at the service level by adding the attribute `allowDefinition="MachineToApplication"` to the element definition.<br><br>Specifying the `<serviceHostingEnvironment>` element at the service level is technically incorrect and causes inconsistent behavior. |

## Windows Presentation Foundation (WPF)

### Applications

Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>

Assemblies: PresentationFramework (in PresentationFramework.dll)

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **Exception handling** | To enable errors to be detected earlier, WPF throws a <xref:System.Reflection.TargetInvocationException> and sets the <xref:System.Exception.InnerException> property to critical exceptions, such as <xref:System.NullReferenceException>, <xref:System.OutOfMemoryException>, <xref:System.StackOverflowException>, and <xref:System.Security.SecurityException>, instead of catching the original exception. | None. |
| **Linked resources** | To make linking easier, resource files (such as images) that are located in a location other than the project's folder structure use the resource file's full path instead of just its file name as the resource ID when the application is built. The application will be able to locate the files at run time. | None. |
| **Partial-trust applications** | For security considerations, Windows-based applications that run in partial trust and contain a <xref:System.Windows.Controls.WebBrowser> control or a <xref:System.Windows.Controls.Frame> control that contains HTML will throw a <xref:System.Security.SecurityException> when the control is created.<br><br>Browser applications will throw an exception and display a message if all of the following conditions are met:<br><br>\* The application is running in Firefox.<br>\* The application is running in partial trust in the Internet zone from non-trusted sites.<br>\* The application contains a <xref:System.Windows.Controls.WebBrowser> control or a <xref:System.Windows.Controls.Frame> control that contains HTML.<br><br>Applications that run from trusted sites or from the intranet zone will not be affected. | In your browser applications, you can ease this change by doing one of the following:<br><br>\* Run the browser application in full trust.<br>\* Have customers add the application's site to the trusted sites zone.<br>\* Have customers run the application in Internet Explorer. |
| **Resource dictionaries** | To improve theme-level resource dictionaries and prevent them from changing, freezable resources that are defined in a resource dictionary and merged into a theme-level dictionary are now always marked as frozen and are immutable. This is the expected behavior for freezable resources. | Applications that modify a resource that is defined in a theme-level merged dictionary should clone the resource and modify the cloned copy. Alternatively, the resource can be marked `x:Shared="false"` so that the <xref:System.Windows.ResourceDictionary> creates a new copy every time the resource is queried. |
| **Windows 7** | To make WPF applications work better on Windows 7, the following improvements were made to correct the behavior of a window:<br><br>\* Dock and gesture states now work as expected based on user interactions.<br>\* The taskbar commands **Cascade windows, Show windows stacked**, and **Show windows side-by-side** now have the correct behavior and update the appropriate properties.<br>\* The `Top`, `Left`, `Width`, and `Height` properties for a maximized or minimized window now contain the correct restore location of the window instead of other values, depending on the monitor. | None. |
| **Windows style and transparency** | An <xref:System.InvalidOperationException> is thrown if you try to set <xref:System.Windows.Window.WindowStyle> to a value other than <xref:System.Windows.WindowStyle> when <xref:System.Windows.Window.AllowsTransparency> is `true` and <xref:System.Windows.WindowState> is <xref:System.Windows.WindowState>. | If you must change the <xref:System.Windows.Window.WindowStyle> when <xref:System.Windows.Window.AllowsTransparency> is `true`, you can call the Win32 `SetWindowLongPtr` function. |
| **XPS Viewer** | WPF does not include the Microsoft XML Paper Specification Essentials Pack (XPSEP). XPSEP is included with Windows 7 and Windows Vista.<br><br>On a computer that is running Windows XP without .NET Framework 3.5 SP1 installed, printing by using a WPF API other than those in <xref:System.Windows.Controls.PrintDialog> will rely on the WINSPOOL. Some printer capabilities will not be reported and some printer settings will not be applied during printing. | If needed, install the Microsoft XML Paper Specification Essentials Pack. |

### Controls

Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>

Assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **Dialog boxes** | To improve reliability, the <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> method is called on the same thread that created the <xref:Microsoft.Win32.FileDialog> control. | Be sure to create a <xref:Microsoft.Win32.FileDialog> control and call the <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> method on the same thread. |
| **Floating windows** | To fix focus restoration logic that incorrectly keeps reactivating a floating window (making it appear like a modal dialog box), focus restoration is now prevented if the candidate is not a child of the window. | None. |
| **Items in collections** | When an item is moved or added to an underlying collection, it appears in the <xref:System.Windows.Data.CollectionView> in the same relative location if the <xref:System.Windows.Data.CollectionView> is not sorted. This provides consistency between the item's position in the collection and in the associated <xref:System.Windows.Data.CollectionView>. | Use the <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> or <xref:System.Windows.Data.CollectionView.IndexOf%2A> method to find the location of an item in a <xref:System.Windows.Data.CollectionView> instead of relying on a fixed location of an item. |
| **Layouts** | To eliminate unnecessary re-layouts, changing the <xref:System.Windows.Controls.Page.ShowsNavigationUI> no longer invalidates layout or causes another layout pass. | If you expect that changing <xref:System.Windows.Controls.Page.ShowsNavigationUI> will cause another layout pass, call <xref:System.Windows.UIElement.InvalidateVisual%2A> after you set the property. |
| **Menus** | To enable ClearType text in menu pop-ups, modifications were made to the <xref:System.Windows.Controls.ControlTemplate> class and to the <xref:System.Windows.Controls.MenuItem> control and other controls. | Applications should not rely on the visual structure of control templates. Only named parts of a <xref:System.Windows.Controls.ControlTemplate> are part of the public contract. If an application must find a certain object in a <xref:System.Windows.Controls.ControlTemplate>, search the visual tree for a specific type instead of relying on a fixed location of an object in the tree. |
| **Navigating** | If a <xref:System.Windows.Controls.Frame> directly navigates to a location, the <xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> property is `true` after the initial navigation. This change prevents additional events from being raised during startup scenarios. | None. |
| **Pop-ups** | The <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> delegate can now be called multiple times during a layout pass instead of only once. | If your <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> delegate calculates the position of a <xref:System.Windows.Controls.Primitives.Popup> based on its previous position, recalculate the position only if the values of the `popupSize`, `targetSize`, or `offset` parameters change. |
| **Property values** | The <xref:System.Windows.DependencyObject.SetCurrentValue%2A> method now lets you set a property to an effective value, although it continues to respect any binding, style, or trigger that affects the property. | Control authors should use <xref:System.Windows.DependencyObject.SetCurrentValue%2A> whenever the property value changes as a side-effect of some other action, including user manipulation. |
| **Text boxes** | For security considerations, the <xref:System.Windows.Forms.TextBoxBase.Copy%2A> and <xref:System.Windows.Forms.TextBoxBase.Cut%2A> methods silently fail when they are called in partial trust.<br><br>In addition, programmatic execution of the <xref:System.Windows.Input.ApplicationCommands.Copy> or <xref:System.Windows.Input.ApplicationCommands.Cut> property on a control that inherits from <xref:System.Windows.Controls.Primitives.TextBoxBase> will be blocked in partial trust. However, user-initiated copy and cut commands, such as clicking a button whose <xref:System.Windows.Controls.Primitives.ButtonBase.Command> property is bound to one of these commands, will work. Standard copy and cut through keyboard shortcuts and the context menu will still work as before in partial trust. | Bind the <xref:System.Windows.Input.ApplicationCommands.Copy> or <xref:System.Windows.Input.ApplicationCommands.Cut> command to a user-initiated action, such as clicking a button. |

### Graphics

Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Media.Effects>

Assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **Bitmap effects** | To improve performance, the <xref:System.Windows.Media.Effects.BitmapEffect> class and the classes that inherit from the <xref:System.Windows.Media.Effects.BitmapEffect> class, although still present, are disabled. The effect will render by using the hardware-accelerated rendering pipeline if the following conditions are true:<br><br>\* The application uses a <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> or a <xref:System.Windows.Media.Effects.BlurBitmapEffect> that has a radius property set less than 100 DIU.<br>\* The video card on the computer that runs the application supports pixel shader 2.0.<br><br>If these conditions are not met, a <xref:System.Windows.Media.Effects.BitmapEffect> object will have no effect.<br><br>Also, Visual Studio produces a compiler warning when it encounters the <xref:System.Windows.Media.Effects.BitmapEffect> object or a subclass.<br><br>The <xref:System.Windows.Media.DrawingContext.PushEffect%2A> method is marked obsolete. | Discontinue using the legacy <xref:System.Windows.Media.Effects.BitmapEffect> and derived classes and instead use the new classes derived from <xref:System.Windows.Media.Effects.Effect>: <xref:System.Windows.Media.Effects.BlurEffect>, <xref:System.Windows.Media.Effects.DropShadowEffect>, and <xref:System.Windows.Media.Effects.ShaderEffect>.<br><br>You can also create your own effects by inheriting from the <xref:System.Windows.Media.Effects.ShaderEffect> class. |
| **Bitmap frames** | The cloned <xref:System.Windows.Media.Imaging.BitmapFrame> objects now receive the <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>, and <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> events. This enables images that are downloaded from the Web and applied to the <xref:System.Windows.Controls.Image> control through a <xref:System.Windows.Style> to work correctly.<br><br>You will see a change in behavior only if all of the following statements are true:<br><br>\* You subscribe to the <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>, or <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> event.<br>\* The source of the <xref:System.Windows.Media.Imaging.BitmapFrame> is from the Web.<br>\* The <xref:System.Windows.Media.Imaging.BitmapFrame> is cloned while the download is still in progress. | Check the sender in the event handler and take action only if the sender is the original <xref:System.Windows.Media.Imaging.BitmapFrame>. |
| **Decoding images** | To prevent an <xref:System.IO.IOException> from not being handled when images may not decode, the <xref:System.Windows.Media.Imaging.BitmapSource> class will raise the <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> event when it does not decode an image. | Remove any exception handling for <xref:System.IO.IOException>, and use the <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> event to check for decode failure. |

### Input

Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>

Assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **Binding command instances** | To provide a mechanism to bind View-Model-based command instances to View-based input gestures, the <xref:System.Windows.Input.InputBinding> class now inherits from <xref:System.Windows.Freezable> instead of <xref:System.Windows.DependencyObject>. The following properties are now dependency properties:<br><br>\* <xref:System.Windows.Input.InputBinding.Command><br>\* <xref:System.Windows.Input.InputBinding.CommandParameter><br>\* <xref:System.Windows.Input.InputBinding.CommandTarget><br><br>This change results in the following:<br><br>\* An <xref:System.Windows.Input.InputBinding> object is now frozen when it is registered instead of remaining mutable.<br>\* You cannot access instance-level <xref:System.Windows.Input.InputBinding> objects from multiple threads, due to the restrictions of the <xref:System.Windows.DependencyObject> class.<br>\* You cannot mutate class-level input bindings after their registration, due to the restrictions of the <xref:System.Windows.Freezable> class.<br>\* You cannot specify input bindings on command instances that are created in a View-Model. | Create separate instances of an <xref:System.Windows.Input.InputBinding> class on separate threads if bindings are to be mutable, or freeze them otherwise. Do not mutate a class-level static <xref:System.Windows.Input.InputBinding> after it has been registered. |
| **Browser applications** | WPF Browser applications (.XBAP) now process key events just like stand-alone WPF applications so that objects receive routed key events in the correct order. | None. |
| **Dead key combinations** | WPF obfuscates dead keys, which produce no visible character, but instead indicates that the key is to be combined with the next letter key to produce one character. The key input events, such as the <xref:System.Windows.Input.Keyboard.KeyDownEvent> event, report when a key is a dead key by setting the <xref:System.Windows.Input.KeyEventArgs.Key> property to the <xref:System.Windows.Input.Key> value. This is usually expected behavior because applications usually do not intend to respond to keyboard input that creates a combined character. | Applications that expect to read keys that were part of combined characters can get the now obfuscated key by using the <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey> property. |
| **Focus manager** | When the <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> method is passed an element that has the [IsFocusScope](xref:System.Windows.Input.FocusManager.IsFocusScope%2A) attached property set to `true`, the method returns an element that is the last keyboard-focused element within that focus scope if and only if the returned element belongs to the same <xref:System.Windows.PresentationSource> object as the element that is passed to the method. | None. |

### UI Automation

Namespace: <xref:System.Windows>, <xref:System.Windows.Automation.Peers>, <xref:System.Windows.Automation.Provider>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>

Assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), UIAutomationProvider (in UIAutomationProvider.dll), WindowsBase (in WindowsBase.dll)

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **Class hierarchy of views** | The <xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> and <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> classes inherit from <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> instead of <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>. | If you inherit from the <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> classes and override the <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A> method, consider returning an object that inherits from the new <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer> class. |
| **Containers off screen** | To fix an incorrect return value, the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> method now correctly returns `false` for item containers that are scrolled out of view. Also, the value of the method is not affected by occlusion by other windows, or by whether the element is visible on a specific monitor. | None. |
| **Menus and child objects** | To enable UI automation of menus that contain children other than <xref:System.Windows.Controls.MenuItem> objects, the <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> method now returns the <xref:System.Windows.Automation.Peers.AutomationPeer> object of a child <xref:System.Windows.UIElement> object, instead of a <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer> object. | None. |
| **New interfaces and assembly** | To enable new features for UI automation, the following interfaces were added:<br><br>\* <xref:System.Windows.Automation.Provider.IItemContainerProvider><br>\* <xref:System.Windows.Automation.Provider.ISynchronizedInputProvider><br>\* <xref:System.Windows.Automation.Provider.IVirtualizedItemProvider> | Any project that builds WPF automation peers must add an explicit reference to UIAutomationProvider.dll. |
| **Thumbs** | The <xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> method returns a value instead of null. Therefore, controls such as <xref:System.Windows.Controls.GridSplitter> that inherit from the <xref:System.Windows.Controls.Primitives.Thumb> class will report a name to UI Automation. | None. |
| **Virtualized elements** | To improve performance, the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> method returns only the child objects that are actually in the visual tree, instead of all child objects, regardless of whether they are virtualized. | Use <xref:System.Windows.Automation.ItemContainerPattern> to iterate over all items of an <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>. |

### XAML

Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Markup>

Assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)

| Feature | Differences from 3.5 SP1 | Recommended changes |
| ------- | ------------------------ | ------------------- |
| **Markup extension** | WPF now correctly always uses the value from the <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> method instead of returning the <xref:System.Windows.Markup.MarkupExtension> object in certain cases when a markup extension is used to set a property or to create an item in a collection. A markup extension might return itself in some cases. | If your application accesses a resource that returned a <xref:System.Windows.Markup.MarkupExtension> object in earlier versions, reference the object that is returned from <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A>, instead of the <xref:System.Windows.Markup.MarkupExtension> object. |
| **Parsing attributes** | Attributes in XAML can now have only one period. For example, the following are valid:<br><br>`<Button Background="Red"/>` (no periods)<br><br>`<Button Button.Background = "Red"/>` (one period)<br><br>The following is no longer valid:<br><br>`<Button Control.Button.Background = "Red"/>` (more than one period) | Correct XAML attributes that have more than one period. |

## XML

The rows in this table describe improvements to features that previously had limitations or other issues.

### Schema and transforms

Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>

Assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)

| Feature | Differences from 3.5 SP1 |
| ------- | ------------------------ |
| **Chameleon schemas** | To prevent data corruption, chameleon schemas are now cloned correctly when they are included with multiple schemas.<br><br>Chameleon schemas are schemas that do not have a target namespace, and when they are included in another XSD, they take on the target namespace of the importing schema. They are often used to include common types into a schema. |
| **ID functions** | The XSLT [id function](/sql/xquery/functions-on-sequences-id) now returns the correct value instead of null when an <xref:System.Xml.XmlReader> object is passed to an XLST.<br><br>If the user created an <xref:System.Xml.XmlReader> object from a LINQ to XML class by using the <xref:System.Xml.Linq.XNode.CreateReader%2A> method, and this <xref:System.Xml.XmlReader> object was passed to an XSLT, any instances of the `id` function in the XSLT previously returned null. This is not an allowed return value for the `id` function. |
| **Namespace attribute** | To prevent data corruption, an <xref:System.Xml.XPath.XPathNavigator> object now returns the local name of the `x:xmlns` attribute correctly. |
| **Namespace declarations** | An <xref:System.Xml.XmlReader> object on a subtree no longer creates duplicate namespace declarations within one XML element. |
| **Schema validation** | To prevent erroneous schema validation, the <xref:System.Xml.Schema.XmlSchemaSet> class allows for XSD schemas to be compiled correctly and consistently. These schemas can include other schemas; for example, `A.xsd` can include `B.xsd`, which can include `C.xsd`. Compiling any one of these causes this graph of dependencies to be traversed. |
| **Script functions** | The [function-available function](/previous-versions/dotnet/netframework-4.0/ms256124(v=vs.100)) no longer incorrectly returns `false` when the function is actually available. |
| **URIs** | The <xref:System.Xml.Linq.XElement.Load%2A> method now returns the correct BaseURI in LINQ queries. |

### Validation

Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>

Assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)

| Feature | Differences from 3.5 SP1 |
| ------- | ------------------------ |
| **Namespace resolvers** | The <xref:System.Xml.XmlReader.ReadContentAs%2A> method no longer ignores the <xref:System.Xml.IXmlNamespaceResolver> resolver passed to it.<br><br>In previous versions, the specified namespace resolver was ignored, and the <xref:System.Xml.XmlReader> was used instead. |
| **White space** | To prevent data loss when you are creating a reader, the <xref:System.Xml.XmlReader.Create%2A> method no longer discards significant white space.<br><br>XML validation recognizes mixed-content mode, where text can be intermixed with XML markup. In mixed mode, all white space is significant and should be reported. |

### Writing

Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>

Assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)

| Feature | Differences from 3.5 SP1 |
| ------- | ------------------------ |
| **Entity references** | To prevent data corruption, entity references are no longer entitized twice in XML attributes.<br><br>If the user tried to write an entity into an `xmlns` attribute or into an `xml:lang` or `xml:space` attribute by using the <xref:System.Xml.XmlWriter.WriteEntityRef%2A> method, the entity was entitized twice in the output, therefore corrupting the data. |
| **New line handling** | To prevent data corruption, <xref:System.Xml.XmlWriter> objects respect the <xref:System.Xml.NewLineHandling> option. |

## See also

- [New Types and Members in .NET Framework 4](/previous-versions/dotnet/netframework-4.0/ff641764(v=vs.100))
- [Migration Guide to .NET Framework 4](/previous-versions/dotnet/netframework-4.0/ff657133(v=vs.100))
- [What's New in .NET Framework 4](/previous-versions/dotnet/netframework-4.0/ms171868(v=vs.100))
- [Version Compatibility in .NET Framework](version-compatibility.md)
- [Migrating Office Solutions to .NET Framework 4](/visualstudio/vsto/migrating-office-solutions-to-the-dotnet-framework-4-or-later)
- [What's Obsolete in the .NET Framework Class Library](../whats-new/whats-obsolete.md)
