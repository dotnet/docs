---
title: "SQL Server Programming and Host Protection Attributes"
ms.custom: ""
ms.date: "03/30/2017"
ms.prod: ".net-framework"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "dotnet-clr"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "SQL Server [.NET Framework]"
  - "permission sets, SQL Server"
  - "SQL Server Programming and Host Protection Attributes"
  - "managed code, SQL Server"
  - "reliability [.NET Framework]"
  - "writing reliable code"
  - "hosts, reliability"
  - "host protection attributes"
  - "HostProtectionAttribute class, reliability"
ms.assetid: 7dfa36b4-e773-4c75-a3ff-ff1af3ce4c4f
caps.latest.revision: 13
author: "mairaw"
ms.author: "mairaw"
manager: "wpickett"
ms.workload: 
  - "dotnet"
---
# SQL Server Programming and Host Protection Attributes
The ability to load and execute managed code in a SQL Server host requires meeting the host's requirements for both code access security and host resource protection.  The code access security requirements are specified by one of three SQL Server permission sets: SAFE, EXTERNAL-ACCESS, or UNSAFE. Code executing within the SAFE or EXTERNAL-ACCESS permission sets must avoid certain types or members that have the <xref:System.Security.Permissions.HostProtectionAttribute> attribute applied. The <xref:System.Security.Permissions.HostProtectionAttribute> is not a security permission as much as a reliability guarantee in that it identifies specific code constructs, either types or methods, that the host may disallow.  The use of the <xref:System.Security.Permissions.HostProtectionAttribute> enforces a programming model that helps protect the stability of the host.  
  
## Host Protection Attributes  
 Host protection attributes identify types or members that do not fit the host programming model and represent the following increasing levels of reliability threat:  
  
-   Are otherwise benign.  
  
-   Could lead to destabilization of server-managed user code.  
  
-   Could lead to destabilization of the server process itself.  
  
 SQL Server disallows the use of a type or member that has a <xref:System.Security.Permissions.HostProtectionAttribute> that specifies a <xref:System.Security.Permissions.HostProtectionResource> value of <xref:System.Security.Permissions.HostProtectionResource.SharedState>, <xref:System.Security.Permissions.HostProtectionResource.Synchronization>, <xref:System.Security.Permissions.HostProtectionResource.MayLeakOnAbort>, or <xref:System.Security.Permissions.HostProtectionResource.ExternalProcessMgmt>. This prevents the assemblies from calling members that enable sharing state, perform synchronization, might cause a resource leak on termination, or affect the integrity of the SQL Server process.  
  
### Disallowed Types and Members  
 The following table identifies types and members whose <xref:System.Security.Permissions.HostProtectionResource> values are disallowed by SQL Server.  
  
|Namespace|Type or member|  
|---------------|--------------------|  
|`Microsoft.Win32`|<xref:Microsoft.Win32.PowerModeChangedEventArgs> class<br /><br /> <xref:Microsoft.Win32.PowerModeChangedEventHandler> delegate<br /><br /> <xref:Microsoft.Win32.SessionEndedEventArgs> class<br /><br /> <xref:Microsoft.Win32.SessionEndedEventHandler> delegate<br /><br /> <xref:Microsoft.Win32.SessionEndingEventArgs> class<br /><br /> <xref:Microsoft.Win32.SessionEndingEventHandler> delegate<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventArgs> class<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventHandler> delegate<br /><br /> <xref:Microsoft.Win32.SystemEvents> class<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventArgs> class<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventHandler> delegate<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangedEventArgs> class<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangingEventArgs> class|  
|`System.Collections`|<xref:System.Collections.ArrayList.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Collections.Hashtable.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Collections.Queue.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Collections.SortedList.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Collections.Stack.Synchronized%2A?displayProperty=nameWithType> method|  
|`System.ComponentModel`|<xref:System.ComponentModel.AddingNewEventArgs> class<br /><br /> <xref:System.ComponentModel.AddingNewEventHandler> delegate<br /><br /> <xref:System.ComponentModel.ArrayConverter> class<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventArgs> class<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.AsyncOperation> class<br /><br /> <xref:System.ComponentModel.AsyncOperationManager> class<br /><br /> <xref:System.ComponentModel.AttributeCollection> class<br /><br /> <xref:System.ComponentModel.BackgroundWorker> class<br /><br /> <xref:System.ComponentModel.BaseNumberConverter> class<br /><br /> <xref:System.ComponentModel.BindingList%601> class<br /><br /> <xref:System.ComponentModel.BooleanConverter> class<br /><br /> <xref:System.ComponentModel.ByteConverter> class<br /><br /> <xref:System.ComponentModel.CancelEventArgs> class<br /><br /> <xref:System.ComponentModel.CancelEventHandler> delegate<br /><br /> <xref:System.ComponentModel.CharConverter> class<br /><br /> <xref:System.ComponentModel.CollectionChangeEventArgs> class<br /><br /> <xref:System.ComponentModel.CollectionChangeEventHandler> delegate<br /><br /> <xref:System.ComponentModel.CollectionConverter> class<br /><br /> <xref:System.ComponentModel.ComponentCollection> class<br /><br /> <xref:System.ComponentModel.ComponentConverter> class<br /><br /> <xref:System.ComponentModel.ComponentEditor> class<br /><br /> <xref:System.ComponentModel.ComponentResourceManager> class<br /><br /> <xref:System.ComponentModel.Container> class<br /><br /> <xref:System.ComponentModel.ContainerFilterService> class<br /><br /> <xref:System.ComponentModel.CultureInfoConverter> class<br /><br /> <xref:System.ComponentModel.CustomTypeDescriptor> class<br /><br /> <xref:System.ComponentModel.DateTimeConverter> class<br /><br /> <xref:System.ComponentModel.DecimalConverter> class<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.CheckoutException> class<br /><br /> <xref:System.ComponentModel.Design.CommandID> class<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.ComponentEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.DesignerCollection> class<br /><br /> <xref:System.ComponentModel.Design.DesignerEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.DesignerEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.DesignerOptionService> class<br /><br /> <xref:System.ComponentModel.Design.DesignerTransaction> class<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.DesignerVerb> class<br /><br /> <xref:System.ComponentModel.Design.DesignerVerbCollection> class<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContext> class<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContextSerializer> class<br /><br /> <xref:System.ComponentModel.Design.MenuCommand> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ComponentSerializationService> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ContextStack> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.DesignerLoader> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.InstanceDescriptor> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.MemberRelationshipService> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.Serialization.SerializationStore> class<br /><br /> <xref:System.ComponentModel.Design.ServiceContainer> class<br /><br /> <xref:System.ComponentModel.Design.ServiceCreatorCallback> delegate<br /><br /> <xref:System.ComponentModel.Design.StandardCommands> class<br /><br /> <xref:System.ComponentModel.Design.StandardToolWindows> class<br /><br /> <xref:System.ComponentModel.DoubleConverter> class<br /><br /> <xref:System.ComponentModel.DoWorkEventArgs> class<br /><br /> <xref:System.ComponentModel.DoWorkEventHandler> delegate<br /><br /> <xref:System.ComponentModel.EnumConverter> class<br /><br /> <xref:System.ComponentModel.EventDescriptor> class<br /><br /> <xref:System.ComponentModel.EventDescriptorCollection> class<br /><br /> <xref:System.ComponentModel.EventHandlerList> class<br /><br /> <xref:System.ComponentModel.ExpandableObjectConverter> class<br /><br /> <xref:System.ComponentModel.HandledEventArgs> class<br /><br /> <xref:System.ComponentModel.HandledEventHandler> delegate<br /><br /> <xref:System.ComponentModel.InstanceCreationEditor> class<br /><br /> <xref:System.ComponentModel.Int16Converter> class<br /><br /> <xref:System.ComponentModel.Int32Converter> class<br /><br /> <xref:System.ComponentModel.Int64Converter> class<br /><br /> <xref:System.ComponentModel.InvalidAsynchronousStateException> class<br /><br /> <xref:System.ComponentModel.InvalidEnumArgumentException> class<br /><br /> <xref:System.ComponentModel.ISynchronizeInvoke.BeginInvoke%2A> method<br /><br /> <xref:System.ComponentModel.License> class<br /><br /> <xref:System.ComponentModel.LicenseContext> class<br /><br /> <xref:System.ComponentModel.LicenseException> class<br /><br /> <xref:System.ComponentModel.LicenseManager> class<br /><br /> <xref:System.ComponentModel.LicenseProvider> class<br /><br /> <xref:System.ComponentModel.LicFileLicenseProvider> class<br /><br /> <xref:System.ComponentModel.ListChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.ListChangedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.ListSortDescription> class<br /><br /> <xref:System.ComponentModel.ListSortDescriptionCollection> class<br /><br /> <xref:System.ComponentModel.MaskedTextProvider> class<br /><br /> <xref:System.ComponentModel.MemberDescriptor> class<br /><br /> <xref:System.ComponentModel.MultilineStringConverter> class<br /><br /> <xref:System.ComponentModel.NestedContainer> class<br /><br /> <xref:System.ComponentModel.NullableConverter> class<br /><br /> <xref:System.ComponentModel.ProgressChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.ProgressChangedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.PropertyChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.PropertyChangedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.PropertyDescriptor> class<br /><br /> <xref:System.ComponentModel.PropertyDescriptorCollection> class<br /><br /> <xref:System.ComponentModel.ReferenceConverter> class<br /><br /> <xref:System.ComponentModel.RefreshEventArgs> class<br /><br /> <xref:System.ComponentModel.RefreshEventHandler> delegate<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventArgs> class<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.SByteConverter> class<br /><br /> <xref:System.ComponentModel.SingleConverter> class<br /><br /> <xref:System.ComponentModel.StringConverter> class<br /><br /> <xref:System.ComponentModel.SyntaxCheck> class<br /><br /> <xref:System.ComponentModel.TimeSpanConverter> class<br /><br /> <xref:System.ComponentModel.TypeConverter> class<br /><br /> <xref:System.ComponentModel.TypeDescriptionProvider> class<br /><br /> <xref:System.ComponentModel.TypeDescriptor> class<br /><br /> <xref:System.ComponentModel.TypeListConverter> class<br /><br /> <xref:System.ComponentModel.UInt16Converter> class<br /><br /> <xref:System.ComponentModel.UInt32Converter> class<br /><br /> <xref:System.ComponentModel.UInt64Converter> class<br /><br /> <xref:System.ComponentModel.WarningException> class<br /><br /> <xref:System.ComponentModel.Win32Exception> class|  
|`System.Diagnostics`|<xref:System.Diagnostics.Debug.Listeners%2A?displayProperty=nameWithType> property<br /><br /> <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType> property<br /><br /> <xref:System.Diagnostics.EventLog.SynchronizingObject%2A?displayProperty=nameWithType> property<br /><br /> <xref:System.Diagnostics.ConsoleTraceListener> class<br /><br /> <xref:System.Diagnostics.DefaultTraceListener> class<br /><br /> <xref:System.Diagnostics.DelimitedListTraceListener> class<br /><br /> <xref:System.Diagnostics.EventLogTraceListener> class<br /><br /> <xref:System.Diagnostics.PerformanceCounter> class<br /><br /> <xref:System.Diagnostics.PerformanceCounterCategory> class<br /><br /> <xref:System.Diagnostics.Process> class<br /><br /> <xref:System.Diagnostics.ProcessStartInfo> class<br /><br /> <xref:System.Diagnostics.TextWriterTraceListener> class<br /><br /> <xref:System.Diagnostics.TraceListener> class<br /><br /> <xref:System.Diagnostics.XmlWriterTraceListener> class<br /><br /> <xref:System.Diagnostics.TraceSource.Listeners%2A?displayProperty=nameWithType> property|  
|`System.IO`|<xref:System.IO.Stream.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.IO.TextReader.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.IO.TextWriter.Synchronized%2A?displayProperty=nameWithType> method|  
|`System.Reflection.Emit`|<xref:System.Reflection.Emit.ConstructorBuilder> class<br /><br /> <xref:System.Reflection.Emit.EventBuilder> class<br /><br /> <xref:System.Reflection.Emit.FieldBuilder> class<br /><br /> <xref:System.Reflection.Emit.MethodBuilder> class<br /><br /> <xref:System.Reflection.Emit.CustomAttributeBuilder> class<br /><br /> <xref:System.Reflection.Emit.MethodRental> class<br /><br /> <xref:System.Reflection.Emit.ModuleBuilder> class<br /><br /> <xref:System.Reflection.Emit.PropertyBuilder> class<br /><br /> <xref:System.Reflection.Emit.TypeBuilder> class<br /><br /> <xref:System.Reflection.Emit.UnmanagedMarshal> class|  
|`System.Text`|<xref:System.Text.RegularExpressions.Group.Synchronized%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Text.RegularExpressions.Match.Synchronized%2A?displayProperty=nameWithType> method|  
|`System.Threading`|<xref:System.Threading.AutoResetEvent> class<br /><br /> <xref:System.Threading.EventWaitHandle> class<br /><br /> <xref:System.Threading.ManualResetEvent> class<br /><br /> <xref:System.Threading.Monitor> class<br /><br /> <xref:System.Threading.Mutex> class<br /><br /> <xref:System.Threading.ReaderWriterLock> class<br /><br /> <xref:System.Threading.Semaphore> class<br /><br /> <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.BeginCriticalRegion%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.EndCriticalRegion%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.FreeNamedDataSlot%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.SetApartmentState%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.SpinWait%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.Thread.TrySetApartmentState%2A?displayProperty=nameWithType> method<br /><br /> <xref:System.Threading.ThreadPool> class<br /><br /> <xref:System.Threading.Timer> class|  
|`System.Timers`|<xref:System.Timers.Timer> class|  
|`System.Web.Configuration`|<xref:System.Web.Configuration.MachineKeyValidationConverter> class|  
|`System.Windows.Forms`|<xref:System.Windows.Forms.AutoCompleteStringCollection.SyncRoot%2A?displayProperty=nameWithType> property|  
  
## SQL Server Permission Sets  
 SQL Server allows users to specify the reliability requirements for code deployed into a database. When assemblies are uploaded into the database, the author of the assembly can specify one of three permission sets for that assembly: SAFE, EXTERNAL-ACCESS, or UNSAFE.  
  
|Permission set|SAFE|EXTERNAL-ACCESS|UNSAFE|  
|--------------------|----------|----------------------|------------|  
|Code access security|Execute only|Execute + access to external resources|Unrestricted|  
|Programming model restrictions|Yes|Yes|No restrictions|  
|Verifiability requirement|Yes|Yes|No|  
|Ability to call native code|No|No|Yes|  
  
 SAFE is the most reliable and secure mode with associated restrictions in terms of the allowed programming model. SAFE code has high reliability and security features. SAFE assemblies are given enough permission to run, perform computations, and have access to the local database. SAFE assemblies need to be verifiably type safe and are not allowed to call unmanaged code.  
  
 EXTERNAL-ACCESS provides an intermediate security option, allowing code to access resources external to the database but still having the reliability and safety of SAFE.  
  
 UNSAFE is for highly trusted code that can only be created by database administrators. This trusted code has no code access restrictions, and it can call unmanaged (native) code.  
  
 SQL Server uses the host-level code access security policy layer to set up a host policy that grants one of the three sets of permissions based on the permission set stored in SQL Server catalogs. Managed code running inside the database always gets one of these code access permission sets.  
  
## Programming Model Restrictions  
 The programming model for managed code in SQL Server requires functions, procedures, and types which do not require the use of state held across multiple invocations or the sharing of state across multiple user sessions. Further, as described earlier, the presence of shared state can cause critical exceptions that impact the scalability and the reliability of the application.  
  
 Given these considerations, SQL Server disallows the use of static variables and static data members. For SAFE and EXTERNAL-ACCESS assemblies, SQL Server examines the metadata of the assembly at CREATE ASSEMBLY time, and fails the creation of such assemblies if it finds the use of static data members and variables.  
  
## See Also  
 <xref:System.Security.Permissions.HostProtectionAttribute>  
 <xref:System.Security.Permissions.HostProtectionResource>
