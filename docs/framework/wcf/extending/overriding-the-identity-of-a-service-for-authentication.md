---
description: "Learn more about: Override the identity of a service for authentication"
title: "Overriding the Identity of a Service for Authentication"
ms.date: "03/30/2017"
dev_langs: 
  - "csharp"
  - "vb"
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
---
# Override the identity of a service for authentication

Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata. For example, the following configuration code uses the [\<wsHttpBinding>](../../configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.  

 The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined. In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name. The UPN is also known as the user sign-in name in a Windows domain.  

 For a sample application that demonstrates identity setting, see [Service Identity Sample](/previous-versions/dotnet/framework/wcf/samples/service-identity-sample). For more information about service identity, see [Service Identity and Authentication](../feature-details/service-identity-and-authentication.md).  
  
## Kerberos Authentication and Identity  

 By default, when a service is configured to use a Windows credential, an [\<identity>](../../configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL. If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data. If the service is running under a different account, Windows Communication Foundation (WCF) generates a UPN in the form of \<*username*>@<*domainName*`>`. This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.  
  
 You can also use the [Setspn](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731241(v=ws.10)) tool to register an additional SPN with a service's account in a domain. You can then use the SPN as the identity of the service. For more information about the tool, see [Setspn Overview](/previous-versions/windows/it-pro/windows-server-2003/cc773257(v=ws.10)).  
  
> [!NOTE]
> To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain. You can do this in the following ways:  
  
- Use the NetworkService or LocalSystem account to run your service. Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, WCF automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).  
  
- Use an arbitrary Active Directory domain account to run your service. In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool. Once you create the SPN for the service's account, configure WCF to publish that SPN to the service's clients through its metadata (WSDL). This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.  
  
 For more information about SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](/previous-versions/msp-n-p/ff649429(v=pandp.10)).  
  
### When SPN or UPN Equals the Empty String  

 If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:  
  
- If you are using transport level security, NT LanMan (NTLM) authentication is chosen.  
  
- If you are using message level security, authentication may fail, depending on the authentication mode:  
  
- If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fails.  
  
- If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty but succeeds if the SPN is empty.  
  
- If you are using Kerberos direct (also known as "one-shot"), authentication fails.  
  
### Use the \<identity> Element in Configuration  

 If you change the client credential type in the binding previously shown to `Certificate`, then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code. This is the default for all client credential types other than Windows.  

 You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code. The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.  

### Set Identity Programmatically  

 Your service does not have to explicitly specify an identity, because WCF automatically determines it. However, WCF allows you to specify an identity on an endpoint, if necessary. The following code adds a new service endpoint with a specific DNS identity.  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## See also

- [How to: Create a Custom Client Identity Verifier](how-to-create-a-custom-client-identity-verifier.md)
- [Service Identity and Authentication](../feature-details/service-identity-and-authentication.md)
