---
title: "CA2018: `Buffer.BlockCopy` expects the number of bytes to be copied for the `count` argument"
description: "Learn about code analysis rule CA2018: `Buffer.BlockCopy` expects the number of bytes to be copied for the `count` argument"
ms.date: 08/17/2021
ms.topic: reference
f1_keywords:
  - "BufferBlockCopyLength"
  - "CA2018"
helpviewer_keywords:
  - "BufferBlockCopyLength"
  - "CA2018"
author: mahdiva
---
# CA2018: `Buffer.BlockCopy` expects the number of bytes to be copied for the `count` argument

| | Value |
|-|-|
| **Rule ID** |CA2018|
| **Category** |[Reliability](reliability-warnings.md)|
| **Fix is breaking or non-breaking** |Non-breaking|

## Cause

This rule fires when `Array.Length` is used for the `count` argument on arrays with elements of size larger than 1 byte.

## Rule description

When using `Buffer.BlockCopy`, the `count` argument expects the number of bytes to be copied. Using `Array.Length` for the `count` argument should only be used for arrays with element size of exactly 1 byte.

## How to fix violations

The `count` argument should be the number of bytes that you intend to copy.

### Example

```csharp
using System;
class Program
{
    static void Main()
    {
        int[] src = new int[] {1, 2, 3, 4};
        int[] dst = new int[] {0, 0, 0, 0};

        Buffer.BlockCopy(src, 0, dst, 0, src.Length); 
    }
}
```

Fix:

When using arrays with elements of size larger than 1 byte, one possible solution is to multiply the length of the array with the array element size to get the number of bytes.

```csharp
using System;
class Program
{
    static void Main()
    {
        int[] src = new int[] {1, 2, 3, 4};
        int[] dst = new int[] {0, 0, 0, 0};

        Buffer.BlockCopy(src, 0, dst, 0, src.Length * sizeof(int));
    }
}
```

## When to suppress warnings

It is generally NOT safe to suppress a warning from this rule.

## See also

- [Reliability rules](reliability-warnings.md)
