---
title: Tackling Business Complexity in a Microservice with DDD and CQRS Patterns | Microsoft Docs 
description: .NET Microservices Architecture for Containerized .NET Applications | Tackling Business Complexity in a Microservice with DDD and CQRS Patterns
keywords: Docker, Microservices, ASP.NET, Container
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/19/2017
---
-   [Vision](#vision)
    -   [Additional resources](#additional-resources)
        -   [DDD (Domain-Driven Design)](#ddd-domain-driven-design)
        -   [DDD books](#ddd-books)
-   [Applying simplified CQRS and DDD patterns in a microservice](#applying-simplified-cqrs-and-ddd-patterns-in-a-microservice)
-   [Applying CQRS and CQS approaches in a DDD microservice in eShopOnContainers](#applying-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers)
    -   [CQRS and DDD patterns are not top-level architectures](#cqrs-and-ddd-patterns-are-not-top-level-architectures)
        -   [ Additional resources](#additional-resources-1)
-   [Implementing reads/queries in a CQRS microservice](#implementing-readsqueries-in-a-cqrs-microservice)
    -   [Using ViewModels specifically made for client apps, independent from domain model constraints](#using-viewmodels-specifically-made-for-client-apps-independent-from-domain-model-constraints)
    -   [Using Dapper as a micro ORM to perform queries ](#using-dapper-as-a-micro-orm-to-perform-queries)
    -   [Dynamic and static ViewModels](#dynamic-and-static-viewmodels)
        -   [Additional resources](#additional-resources-2)
-   [Designing a DDD-oriented microservice](#designing-a-ddd-oriented-microservice)
    -   [Keep the microservice context boundaries relatively small](#keep-the-microservice-context-boundaries-relatively-small)
    -   [Layers in DDD microservices](#layers-in-ddd-microservices)
        -   [The domain model layer](#the-domain-model-layer)
        -   [The application layer](#the-application-layer)
        -   [The infrastructure layer](#the-infrastructure-layer)
            -   [Additional resources](#additional-resources-3)
-   [Designing a microservice domain model](#designing-a-microservice-domain-model)
    -   [The Domain Entity pattern](#the-domain-entity-pattern)
        -   [Rich domain model versus anemic domain model](#rich-domain-model-versus-anemic-domain-model)
            -   [Additional resources](#additional-resources-4)
        -   [The Value Object pattern](#the-value-object-pattern)
            -   [Additional resources](#additional-resources-5)
        -   [The Aggregate pattern](#the-aggregate-pattern)
        -   [The Aggregate Root or Root Entity pattern](#the-aggregate-root-or-root-entity-pattern)
            -   [Additional resources](#additional-resources-6)
-   [Implementing a microservice domain model with .NET Core ](#implementing-a-microservice-domain-model-with-.net-core)
    -   [Domain model structure in a custom .NET Standard Library](#domain-model-structure-in-a-custom-.net-standard-library)
    -   [Structuring aggregates in a custom .NET Standard Library](#structuring-aggregates-in-a-custom-.net-standard-library)
    -   [Implementing domain entities as POCO classes](#implementing-domain-entities-as-poco-classes)
        -   [Mapping properties with only get accessors to the fields in the database table](#mapping-properties-with-only-get-accessors-to-the-fields-in-the-database-table)
        -   [Mapping fields without properties](#mapping-fields-without-properties)
        -   [Additional resources](#additional-resources-7)
    -   [Seedwork (reusable base classes and interfaces for your domain model)](#seedwork-reusable-base-classes-and-interfaces-for-your-domain-model)
        -   [The custom Entity base class](#the-custom-entity-base-class)
    -   [Repository contracts (interfaces) in the domain model layer](#repository-contracts-interfaces-in-the-domain-model-layer)
        -   [Additional resources](#additional-resources-8)
    -   [Implementing value objects](#implementing-value-objects)
        -   [Important characteristics of value objects](#important-characteristics-of-value-objects)
        -   [Value object implementation in C\#](#value-object-implementation-in-c)
        -   [Hiding the identity characteristic when using EF Core to persist value objects](#hiding-the-identity-characteristic-when-using-ef-core-to-persist-value-objects)
            -   [Additional resources](#additional-resources-9)
    -   [Using Enumeration classes instead of C\# language enum types](#using-enumeration-classes-instead-of-c-language-enum-types)
        -   [Implementing Enumeration classes](#implementing-enumeration-classes)
            -   [Additional resources](#additional-resources-10)
    -   [Designing validations in the domain model layer](#designing-validations-in-the-domain-model-layer)
    -   [Implementing validations in the domain model layer](#implementing-validations-in-the-domain-model-layer)
        -   [Validating conditions and throwing exceptions](#validating-conditions-and-throwing-exceptions)
        -   [Using validation attributes in the model based on data annotations](#using-validation-attributes-in-the-model-based-on-data-annotations)
        -   [Validating entities by implementing the Specification pattern and the Notification pattern](#validating-entities-by-implementing-the-specification-pattern-and-the-notification-pattern)
        -   [Using deferred validation in the domain](#using-deferred-validation-in-the-domain)
        -   [Two-step validation](#two-step-validation)
            -   [Additional resources](#additional-resources-11)
    -   [Client-side validation (validation in the presentation layers)](#client-side-validation-validation-in-the-presentation-layers)
        -   [Additional resources](#additional-resources-12)
            -   [Validation in Xamarin mobile apps](#validation-in-xamarin-mobile-apps)
            -   [Validation in ASP.NET Core apps](#validation-in-asp.net-core-apps)
            -   [Validation in SPA Web apps (Angular 2, TypeScript, JavaScript) ](#validation-in-spa-web-apps-angular-2-typescript-javascript)
-   [Domain events: design and implementation](#domain-events-design-and-implementation)
    -   [What is a domain event?](#what-is-a-domain-event)
    -   [Domain events versus integration events](#domain-events-versus-integration-events)
        -   [Domain events as a preferred way to trigger side effects across multiple aggregates within the same domain](#domain-events-as-a-preferred-way-to-trigger-side-effects-across-multiple-aggregates-within-the-same-domain)
-   [Implementing domain events](#implementing-domain-events)
    -   [Raising domain events](#raising-domain-events)
        -   [The deferred approach for raising and dispatching events](#the-deferred-approach-for-raising-and-dispatching-events)
    -   [Single transaction across aggregates versus eventual consistency across aggregates](#single-transaction-across-aggregates-versus-eventual-consistency-across-aggregates)
    -   [The domain event dispatcher: mapping from events to event handlers](#the-domain-event-dispatcher-mapping-from-events-to-event-handlers)
    -   [How to subscribe to domain events](#how-to-subscribe-to-domain-events)
    -   [How to handle domain events](#how-to-handle-domain-events)
        -   [Domain events can generate integration events to be published outside of the microservice boundaries](#domain-events-can-generate-integration-events-to-be-published-outside-of-the-microservice-boundaries)
    -   [Conclusions on domain events ](#conclusions-on-domain-events)
        -   [Additional resources](#additional-resources-13)
-   [Designing the infrastructure persistence layer](#designing-the-infrastructure-persistence-layer)
    -   [The Repository pattern](#the-repository-pattern)
        -   [Define one repository per aggregate](#define-one-repository-per-aggregate)
        -   [Enforcing one aggregate root per repository](#enforcing-one-aggregate-root-per-repository)
        -   [The Repository pattern makes it easier to test your application logic](#the-repository-pattern-makes-it-easier-to-test-your-application-logic)
        -   [The difference between the Repository pattern and the legacy Data Access class (DAL class) pattern](#the-difference-between-the-repository-pattern-and-the-legacy-data-access-class-dal-class-pattern)
        -   [Repositories should not be mandatory](#repositories-should-not-be-mandatory)
            -   [Additional resources](#additional-resources-14)
                -   [The Repository pattern](#the-repository-pattern-1)
                -   [Unit of Work pattern](#unit-of-work-pattern)
-   [Implementing the infrastructure persistence layer with Entity Framework Core](#implementing-the-infrastructure-persistence-layer-with-entity-framework-core)
    -   [Introduction to Entity Framework Core](#introduction-to-entity-framework-core)
        -   [Additional resources](#additional-resources-15)
    -   [Infrastructure in Entity Framework Core from a DDD perspective](#infrastructure-in-entity-framework-core-from-a-ddd-perspective)
    -   [Implementing custom repositories with Entity Framework Core](#implementing-custom-repositories-with-entity-framework-core)
        -   [Methods to implement in a repository (updates or transactions versus queries)](#methods-to-implement-in-a-repository-updates-or-transactions-versus-queries)
        -   [Using a custom repository versus using EF DbContext directly](#using-a-custom-repository-versus-using-ef-dbcontext-directly)
    -   [EF DbContext and IUnitOfWork instance lifetime in your IoC container](#ef-dbcontext-and-iunitofwork-instance-lifetime-in-your-ioc-container)
    -   [The repository instance lifetime in your IoC container](#the-repository-instance-lifetime-in-your-ioc-container)
        -   [Additional resources](#additional-resources-16)
    -   [Table mapping](#table-mapping)
        -   [Data Annotations versus Fluent API](#data-annotations-versus-fluent-api)
        -   [Fluent API and the OnModelCreating method](#fluent-api-and-the-onmodelcreating-method)
        -   [The Hi/Lo algorithm in EF Core](#the-hilo-algorithm-in-ef-core)
        -   [Mapping fields instead of properties](#mapping-fields-instead-of-properties)
        -   [Using shadow properties in value objects for hidden IDs at the infrastructure level](#using-shadow-properties-in-value-objects-for-hidden-ids-at-the-infrastructure-level)
            -   [Additional resources](#additional-resources-17)
-   [Using NoSQL databases as a persistence infrastructure](#using-nosql-databases-as-a-persistence-infrastructure)
    -   [Additional resources](#additional-resources-18)
-   [Designing the microservice application layer and Web API](#designing-the-microservice-application-layer-and-web-api)
    -   [Using SOLID principles and Dependency Injection](#using-solid-principles-and-dependency-injection)
        -   [Additional resources](#additional-resources-19)
-   [Implementing the microservice application layer using the Web API](#implementing-the-microservice-application-layer-using-the-web-api)
    -   [Using Dependency Injection to inject infrastructure objects into your application layer](#using-dependency-injection-to-inject-infrastructure-objects-into-your-application-layer)
        -   [Registering the dependency implementation types and interfaces or abstractions](#registering-the-dependency-implementation-types-and-interfaces-or-abstractions)
            -   [Using the built-in IoC container provided by ASP.NET Core](#using-the-built-in-ioc-container-provided-by-asp.net-core)
            -   [Using the Scrutor library for automatic types registration](#using-the-scrutor-library-for-automatic-types-registration)
            -   [Additional resources](#additional-resources-20)
            -   [Using Autofac as an IoC container](#using-autofac-as-an-ioc-container)
            -   [Additional resources](#additional-resources-21)
    -   [Implementing the Command and Command Handler patterns](#implementing-the-command-and-command-handler-patterns)
        -   [The command class](#the-command-class)
        -   [The Command Handler class](#the-command-handler-class)
            -   [Additional resources](#additional-resources-22)
    -   [The Command process pipeline: how to trigger a command handler](#the-command-process-pipeline-how-to-trigger-a-command-handler)
        -   [Using the Mediator pattern (in-memory) in the command pipeline](#using-the-mediator-pattern-in-memory-in-the-command-pipeline)
        -   [Using message queues (out-of-proc) in the commandâ€™s pipeline](#using-message-queues-out-of-proc-in-the-commands-pipeline)
    -   [Implementing the command process pipeline with a mediator pattern (MediatR)](#implementing-the-command-process-pipeline-with-a-mediator-pattern-mediatr)
    -   [Applying cross-cutting concerns when processing commands with the Mediator and Decorator patterns](#applying-cross-cutting-concerns-when-processing-commands-with-the-mediator-and-decorator-patterns)
        -   [Additional resources](#additional-resources-23)
            -   [The mediator pattern](#the-mediator-pattern)
            -   [The decorator pattern](#the-decorator-pattern)
            -   [MediatR (Jimmy Bogard)](#mediatr-jimmy-bogard)
            -   [Fluent validation](#fluent-validation)



>[!div class="step-by-step"]
[Previous] (../designing-and-developing-multi-container-and-microservice-based-net-applications/testing-asp.net-core-services-and-web-apps.md)
[Next] (vision.md)
