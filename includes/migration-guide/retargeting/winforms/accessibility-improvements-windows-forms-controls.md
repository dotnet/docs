### Accessibility improvements in Windows Forms controls

|   |   |
|---|---|
|Details|Windows Forms is improving how it works with accessibility technologies to better support Windows Forms customers. These include the following changes:<ul><li>Changes to improve display during High Contrast mode.</li><li>Changes to improve the property browser experience. Property browser improvements include:</li><li>Better keyboard navigation through the various drop-down selection windows.</li><li>Reduced unnecessary tab stops.</li><li>Better reporting of control types.</li><li>Improved narrator behavior.</li><li>Changes to implement missing UI accessibility patterns in controls.</li></ul>|
|Suggestion|<strong>How to opt in or out of these changes</strong>In order for the application to benefit from these changes, it must run on the .NET Framework 4.7.1 or later. The application can benefit from these changes in either of the following ways:<ul><li>It is recompiled to target the .NET Framework 4.7.1. These accessibility changes are enabled by default on Windows Forms applications that target the .NET Framework 4.7.1 or later.</li><li>It opts out of the legacy accessibility behaviors by adding the following [AppContext switch](https://docs.microsoft.com/dotnet/framework/configure-apps/file-schema/runtime/appcontextswitchoverrides-element) to the <code>&lt;runtime&gt;</code> section of the app.config file and setting it to <code>false</code>, as the following example shows.</li></ul><pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#13;&#10;&lt;configuration&gt;&#13;&#10;&lt;startup&gt;&#13;&#10;&lt;supportedRuntime version=&quot;v4.0&quot; sku=&quot;.NETFramework,Version=v4.7&quot;/&gt;&#13;&#10;&lt;/startup&gt;&#13;&#10;&lt;runtime&gt;&#13;&#10;&lt;!-- AppContextSwitchOverrides value attribute is in the form of &#39;key1=true/false;key2=true/false  --&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.UseLegacyAccessibilityFeatures=false&quot; /&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;&lt;/configuration&gt;&#13;&#10;</code></pre>Applications that target the .NET Framework 4.7.1 or later and want to preserve the legacy accessibility behavior can opt in to the use of legacy accessibility features by explicitly setting this AppContext switch to <code>true</code>.For an overview of UI automation, see the [UI Automation Overview](https://docs.microsoft.com/dotnet/framework/ui-automation/ui-automation-overview).<strong>Added support for UI Automation patterns and properties</strong>Accessibility clients can take advantage of new WinForms accessibility functionality by using common, publicly described invocation patterns. These patterns are not WinForms-specific. For instance, accessibility clients can call the QueryInterface method on the IAccessible interface (MAAS) to obtain an IServiceProvider interface. If this interface is available, clients can use its QueryService method to request an IAccessibleEx interface. For more information, see [Using IAccessibleEx from a Client](https://msdn.microsoft.com/library/windows/desktop/dd561924.aspx). Starting with the .NET Framework 4.7.1, IServiceProvider and [IAccessibleEx](https://msdn.microsoft.com/library/windows/desktop/dd561898.aspx) (where applicable) are available for WinForms accessibility objects.The .NET Framework 4.7.1 adds support for the following UI automation patterns and properties:<ul><li>The <code>T:System.Windows.Forms.ToolStripSplitButton</code> and <code>T:System.Windows.Forms.ComboBox</code> controls support the [Expand/Collapse pattern](https://docs.microsoft.com/dotnet/framework/ui-automation/implementing-the-ui-automation-expandcollapse-control-pattern).</li><li>The <code>T:System.Windows.Forms.ToolStripMenuItem</code> control has a [ControlType](https://docs.microsoft.com/dotnet/framework/ui-automation/ui-automation-support-for-the-menubar-control-type) property value <xref:System.Windows.Automation.ControlType.MenuItem?displayProperty=nameWithType>.</li><li>The <code>T:System.Windows.Forms.ToolStripItem</code> control supports the [Name](https://docs.microsoft.com/dotnet/api/system.windows.automation.automationelement.nameproperty) property and [Expand/Collapse pattern](https://docs.microsoft.com/dotnet/framework/ui-automation/implementing-the-ui-automation-expandcollapse-control-pattern).</li><li>The <code>T:System.Windows.Forms.ToolStripDropDownItem</code> control supports [AccessibleEvents](https://docs.microsoft.com/dotnet/api/system.windows.forms.accessibleevents) indicating StateChange and NameChange when drop down is expanded or collapsed.</li><li>The <code>T:System.Windows.Forms.ToolStripDropDownButton</code> control has a [ControlType](https://docs.microsoft.com/dotnet/framework/ui-automation/ui-automation-support-for-the-menubar-control-type) property value of <xref:System.Windows.Automation.ControlType.MenuItem?displayProperty=nameWithType>.</li><li>The <code>T:System.Windows.Forms.DataGridViewCheckBoxCell</code> control supports the [Toggle Pattern](https://docs.microsoft.com/dotnet/api/system.windows.automation.togglepattern).</li><li>The <code>T:System.Windows.Forms.NumericUpDown</code> and <code>T:System.Windows.Forms.DomainUpDown</code> controls support the [Name](https://docs.microsoft.com/dotnet/api/system.windows.automation.automationelement.nameproperty) and have a [ControlType](https://docs.microsoft.com/dotnet/framework/ui-automation/ui-automation-support-for-the-spinner-control-type) of <xref:System.Windows.Automation.ControlType.Spinner?displayProperty=nameWithType>.</li></ul><strong>Improvements to the PropertyGrid control</strong>The .NET Framework 4.7.1 adds the following improvements to the PropertyBrowser control:<ul><li>The <strong>Details</strong> button in the error dialog that is displayed when the user enters an incorrect value in the <code>T:System.Windows.Forms.PropertyGrid</code> control supports the [Expand/Collapse pattern](https://docs.microsoft.com/dotnet/framework/ui-automation/implementing-the-ui-automation-expandcollapse-control-pattern), state and name change notifications, and a [ControlType](https://docs.microsoft.com/dotnet/framework/ui-automation/ui-automation-support-for-the-menubar-control-type) property with a value of <xref:System.Windows.Automation.ControlType.MenuItem?displayProperty=nameWithType>.</li><li>The message pane displayed when the <strong>Details</strong> button of the error dialog is expanded is now keyboard accessible and allows Narrator to announce the content of the error message.</li><li>The [AccessibleRole](https://docs.microsoft.com/dotnet/api/system.windows.forms.accessiblerole) of rows in <code>T:System.Windows.Forms.PropertyGrid</code> control have changed from &quot;Row&quot; to &quot;Cell&quot;. The cell maps to UIA ControlType &quot;DataItem&quot;, which allows it to support appropriate keyboard shortcuts and Narrator announcements.</li><li>The <code>T:System.Windows.Forms.PropertyGrid</code> control rows which represent header items when the <code>T:System.Windows.Forms.PropertyGrid</code> control has a <code>P:System.Windows.Forms.PropertySort</code> property set to <code>F:System.Windows.Forms.PropertySory.Categorized</code> have a [ControlType](https://docs.microsoft.com/dotnet/framework/ui-automation/ui-automation-support-for-the-menubar-control-type) property value of <xref:System.Windows.Automation.ControlType.Button?displayProperty=nameWithType></li><li>The <code>T:System.Windows.Forms.PropertyGrid</code> control rows which represent header items when the <code>T:System.Windows.Forms.PropertyGrid</code> control has a <code>P:System.Windows.Forms.PropertySort</code> property set to <code>F:System.Windows.Forms.PropertySory.Categorized</code> support the [Expand/Collapse pattern](https://docs.microsoft.com/dotnet/framework/ui-automation/implementing-the-ui-automation-expandcollapse-control-pattern).</li><li>Improved keyboard navigation between the grid and the ToolBar above it. Pressing &quot;Shift-Tab&quot; now selects the first ToolBar button, instead of the whole ToolBar</li><li><code>T:System.Windows.Forms.PropertyGrid</code> controls displayed in High Contrast mode will now draw a focus rectangle around the ToolBar button which corresponds to the current <code>P:System.Windows.Forms.PropertySort</code> property value.</li><li><code>T:System.Windows.Forms.PropertyGrid</code> controls displayed in High Contrast mode and with a <code>P:System.Windows.Forms.PropertySort</code> property set to <code>F:System.Windows.Forms.PropertySory.Categorized</code> will now display the background of category headers in a highly contrasting color.</li><li><code>T:System.Windows.Forms.PropertyGrid</code> controls better differentiates between ToolBar items with focus and the ToolBar items which indicate the current value of the <code>P:System.Windows.Forms.PropertySort</code> property. This fix consists of a High Contrast change and a change for non-High Contrast scenarios.</li><li><code>T:System.Windows.Forms.PropertyGrid</code> control ToolBar items which indicates the current value of the <code>P:System.Windows.Forms.PropertySort</code> property support the [Toggle Pattern](https://docs.microsoft.com/dotnet/api/system.windows.automation.togglepattern).</li><li>Improved Narrator support for distinguishing the selected alignment in the Alignment Picker.</li><li>When an empty <code>T:System.Windows.Forms.PropertyGrid</code> control is displayed on a form, it will now receive focus where previously it would not.</li></ul><strong>Use of OS-defined colors in High Contrast themes</strong><ul><li><code>T:System.Windows.Forms.Button</code> and <code>T:System.Windows.Forms.CheckBox</code> controls with <code>P:System.Windows.Forms.Control.FlatStyle</code> set to <xref:System.Windows.Forms.FlatStyle.System?displayProperty=nameWithType>, which is the default style, now use OS-defined colors in High Contrast theme when selected. Previously, text and background colors were not contrasting and were hard to read.</li><li><code>T:System.Windows.Forms.Button</code>, <code>T:System.Windows.Forms.CheckBox</code>, <code>T:System.Windows.Forms.RadioButton</code>, <code>T:System.Windows.Forms.Label</code>, <code>T:System.Windows.Forms.LinkLabel</code> and <code>T:System.Windows.Forms.GroupBox</code> with<code>P:System.Windows.Forms.Control.Enabled</code> set to <em>false</em>, used a shaded color to render text in High Contrast themes, resulting in low contrast against the background. Now these controls use &quot;Disabled Text&quot; color defined by the OS. This fix applies to controls with <code>P:System.Windows.Forms.Control.FlatStyle</code> property set to a value other than <code>F:System.Windows.Forms.FlatStyle.System</code>. The latter controls are rendered by the OS.</li><li><code>T:System.Windows.Forms.DataGridView</code> now renders a visible rectangle around the content of the cell which has the current focus. Previously, this was not visible in certain High Contrast themes.</li><li><code>T:System.Windows.Forms.ToolStripMenuItem</code> controls with a <code>P:System.Windows.Forms.ToolStripItem.Enabled</code> property set to <em>false</em> now use the &quot;Disabled Text&quot; color defined by the OS.</li><li><code>T:System.Windows.Forms.ToolStripMenuItem</code> controls with a <code>P:System.Windows.Forms.ToolStripItem.Checked</code> property set to <em>true</em> now render the associated check mark in a contrasting system color.  Previously the check mark color was not contrasting enough and not visible in High Contrast themes.</li></ul>NOTE: Windows10 has changed values for some high contrast system colors. Windows Forms Framework is based on the Win32 framework. For the best experience, run on the latest version of Windows and opt in to the latest OS changes by adding an app.manifest file in a test application and uncommenting the following code:<pre><code>&lt;!-- Windows 10 --&gt;&#13;&#10;&lt;supportedOS Id=&quot;{8e0f7a12-bfb3-4fe8-b9a5-48fd50a15a9a}&quot; /&gt;&#13;&#10;</code></pre><strong>Improved keyboard navigation</strong><ul><li>When a <code>T:System.Windows.Forms.ComboBox</code> control has <code>P:System.Windows.Forms.ComboBox.DropDownStyle</code> set to <code>F:System.Windows.Forms.DropDownStyle.DropDownList</code> and is the first control in the tab order on the form, it now displays a focus rectangle when the parent form is opened using the keyboard. Before this change, keyboard focus was on this control, but a focus indicator was not rendered.</li></ul><strong>Improved Narrator support</strong><ul><li>The <code>T:System.Windows.Forms.MonthCalendar</code> control has added support for assistive technologies to access the control, including the ability for Narrator to read the value of the control when previously it could not.</li><li>The <code>T:System.Windows.Forms.CheckedListBox</code> control now notifies Narrator when the <code>P:System.Windows.Forms.CheckState</code> property has been changed. Previously, Narrator did not recieve notification and as a result users would not be informed that the <code>P:System.Windows.Forms.CheckState</code> had been updated.</li><li>The <code>T:System.Windows.Forms.LinkLabel</code> control has changed the way it notifies Narrator of the text of in the control. Previously, Narrator announced this text twice and read &quot;&amp;&quot; symbols as real text even though they are not visible to a user. The duplicated text was removed from the Narrator announcements, as well as unnecessary &quot;&amp;&quot; symbols.</li><li>The <code>T:System.Windows.Forms.DataGridViewCell</code> control types now correctly report the read-only status to Narrator and other assistive technologies.</li><li>Narrator is now able to read the System Menu of child windows in [Multiple-Document Interface]~/docs/framework/winforms/advanced/multiple-document-interface-mdi-applications.md) applications.</li><li>Narrator is now able to read <code>T:System.Windows.Forms.ToolStripMenuItem</code> controls with a <code>P:System.Windows.Forms.ToolStripItem.Enabled</code> property set to <em>false</em>. Previously, Narrator was unable to focus on disabled menu items to read hte content.</li></ul>|
|Scope|Major|
|Version|4.7.1|
|Type|Retargeting|
|Affected APIs|<ul><li><xref:System.Windows.Forms.ToolStripDropDownButton.CreateAccessibilityInstance?displayProperty=nameWithType></li><li><xref:System.Windows.Forms.DomainUpDown.DomainUpDownAccessibleObject.Name?displayProperty=nameWithType></li><li>[MonthCalendar.AccessibilityObject](xref:System.Windows.Forms.Control.AccessibilityObject)</li></ul>|

